"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("gun"));require("gun/sea");var n=e(require("dexie")),r=e(require("fuse.js"));function i(){i=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof h?t:h).prototype),a=new A(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=x(s,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function h(){}function f(){}function d(){}var g={};u(g,a,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(E([])));v&&v!==t&&n.call(v,a)&&(g=v);var y=d.prototype=h.prototype=Object.create(g);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var r;this._invoke=function(i,a){function s(){return new t((function(r,s){!function r(i,a,s,o){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(p).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,o)}))}o(u.arg)}(i,a,r,s)}))}return r=r?r.then(s,s):s()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=d,u(y,"constructor",d),u(d,"constructor",f),f.displayName=u(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(w.prototype),u(w.prototype,s,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new w(c(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),u(y,o,"Generator"),u(y,a,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function a(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){a(s,r,i,o,u,"next",e)}function u(e){a(s,r,i,o,u,"throw",e)}o(void 0)}))}}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function p(e,t,n){return(p=l()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i}).apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return(h=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return p(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)})(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g={throttle:function(e,t){var n;return function(){var r=arguments,i=this;n||(e.apply(i,r),n=!0,setTimeout((function(){return n=!1}),t))}},debounce:function(e,t){var n;return function(){var r=arguments,i=this;clearTimeout(n),n=setTimeout((function(){return e.apply(i,r)}),t)}},sample:function(e){return e[Math.floor(Math.random()*e.length)]},sampleSize:function(e,t){for(var n,r,i=e.slice(0),a=e.length,s=a-t;a-- >s;)n=i[r=Math.floor((a+1)*Math.random())],i[r]=i[a],i[a]=n;return i.slice(s)},defer:function(e){return setTimeout(e,0)},once:function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},omit:function(e,t){var n={};return Object.keys(e).forEach((function(r){t.includes(r)||(n[r]=e[r])})),n},defaults:function(e,t){return Object.keys(t).forEach((function(n){void 0===e[n]&&(e[n]=t[n])})),e},pickBy:function(e,t){var n={};return Object.keys(e).forEach((function(r){t(e[r])&&(n[r]=e[r])})),n},isEqual:function(e,t){if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e!=e&&t!=t;if(e.prototype!==t.prototype)return!1;var n=Object.keys(e);return n.length===Object.keys(t).length&&n.every((function(n){return g.isEqual(e[n],t[n])}))},uniq:function(e){var t=new Set(e);return Array.from(t)}},m=!1;try{m="[object process]"===Object.prototype.toString.call(global.process)}catch(e){}var v=!m&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase(),y=v&&v.indexOf(" electron/")>-1,b=["canidae","felidae","cat","cattle","dog","donkey","goat","horse","pig","rabbit","aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","capybara","cardinal","caribou","carp","cat","catshark","caterpillar","catfish","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","cicada","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragonfly","dragon","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","gamefowl","galliform","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","urial","vicuna","viper","vole","vulture","wallaby","walrus","wasp","warbler","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra","alpaca","cat","cattle","chicken","dog","donkey","ferret","gayal","goldfish","guppy","horse","koi","llama","sheep","yak","unicorn"],w=["average","big","colossal","fat","giant","gigantic","great","huge","immense","large","little","long","mammoth","massive","miniature","petite","puny","short","small","tall","tiny","boiling","breezy","broken","bumpy","chilly","cold","cool","creepy","crooked","cuddly","curly","damaged","damp","dirty","dry","dusty","filthy","flaky","fluffy","wet","broad","chubby","crooked","curved","deep","flat","high","hollow","low","narrow","round","shallow","skinny","square","steep","straight","wide","ancient","brief","early","fast","late","long","modern","old","quick","rapid","short","slow","swift","young","abundant","empty","few","heavy","light","many","numerous","Sound","cooing","deafening","faint","harsh","hissing","hushed","husky","loud","melodic","moaning","mute","noisy","purring","quiet","raspy","resonant","screeching","shrill","silent","soft","squealing","thundering","voiceless","whispering","bitter","delicious","fresh","juicy","ripe","rotten","salty","sour","spicy","stale","sticky","strong","sweet","tasteless","tasty","thirsty","fluttering","fuzzy","greasy","grubby","hard","hot","icy","loose","melted","plastic","prickly","rainy","rough","scattered","shaggy","shaky","sharp","shivering","silky","slimy","slippery","smooth","soft","solid","steady","sticky","tender","tight","uneven","weak","wet","wooden","afraid","angry","annoyed","anxious","arrogant","ashamed","awful","bad","bewildered","bored","combative","condemned","confused","creepy","cruel","dangerous","defeated","defiant","depressed","disgusted","disturbed","eerie","embarrassed","envious","evil","fierce","foolish","frantic","frightened","grieving","helpless","homeless","hungry","hurt","ill","jealous","lonely","mysterious","naughty","nervous","obnoxious","outrageous","panicky","repulsive","scary","scornful","selfish","sore","tense","terrible","thoughtless","tired","troubled","upset","uptight","weary","wicked","worried","agreeable","amused","brave","calm","charming","cheerful","comfortable","cooperative","courageous","delightful","determined","eager","elated","enchanting","encouraging","energetic","enthusiastic","excited","exuberant","fair","faithful","fantastic","fine","friendly","funny","gentle","glorious","good","happy","healthy","helpful","hilarious","jolly","joyous","kind","lively","lovely","lucky","obedient","perfect","pleasant","proud","relieved","silly","smiling","splendid","successful","thoughtful","victorious","vivacious","witty","wonderful","zealous","zany","other","good","new","old","great","high","small","different","large","local","social","important","long","young","national","british","right","early","possible","big","little","political","able","late","general","full","far","low","public","available","bad","main","sure","clear","major","economic","only","likely","real","black","particular","international","special","difficult","certain","open","whole","white","free","short","easy","strong","european","central","similar","human","common","necessary","single","personal","hard","private","poor","financial","wide","foreign","simple","recent","concerned","american","various","close","fine","english","wrong","present","royal","natural","individual","nice","french","nihilist","solipsist","materialist","surrealist","heroic","awesome","hedonist","absurd","current","modern","labour","legal","happy","final","red","normal","serious","previous","total","prime","significant","industrial","sorry","dead","specific","appropriate","top","soviet","basic","military","original","successful","aware","hon","popular","heavy","professional","direct","dark","cold","ready","green","useful","effective","western","traditional","scottish","german","independent","deep","interesting","considerable","involved","physical","hot","existing","responsible","complete","medical","blue","extra","past","male","interested","fair","essential","beautiful","civil","primary","obvious","future","environmental","positive","senior","nuclear","annual","relevant","huge","rich","commercial","safe","regional","practical","official","separate","key","chief","regular","due","additional","active","powerful","complex","standard","impossible","light","warm","middle","fresh","sexual","front","domestic","actual","united","technical","ordinary","cheap","strange","internal","excellent","quiet","soft","potential","northern","religious","quick","very","famous","cultural","proper","broad","joint","formal","limited","conservative","lovely","usual","ltd","unable","rural","initial","substantial","bright","average","leading","reasonable","immediate","suitable","equal","detailed","working","overall","female","afraid","democratic","growing","sufficient","scientific","eastern","correct","inc","irish","expensive","educational","mental","dangerous","critical","increased","familiar","unlikely","double","perfect","slow","tiny","dry","historical","thin","daily","southern","increasing","wild","alone","urban","empty","married","narrow","liberal","supposed","upper","apparent","tall","busy","bloody","prepared","russian","moral","careful","clean","attractive","japanese","vital","thick","alternative","fast","ancient","elderly","rare","external","capable","brief","wonderful","grand","typical","entire","grey","constant","vast","surprised","ideal","terrible","academic","funny","minor","pleased","severe","ill","corporate","negative","permanent","weak","brown","fundamental","odd","crucial","inner","used","criminal","contemporary","sharp","sick","near","roman","massive","unique","secondary","parliamentary","african","unknown","subsequent","angry","alive","guilty","lucky","enormous","well","yellow","unusual","net","tough","dear","extensive","glad","remaining","agricultural","alright","healthy","italian","principal","tired","efficient","comfortable","chinese","relative","friendly","conventional","willing","sudden","proposed","voluntary","slight","valuable","dramatic","golden","temporary","federal","keen","flat","silent","indian","worried","pale","statutory","welsh","dependent","firm","wet","competitive","armed","radical","outside","acceptable","sensitive","living","pure","global","emotional","sad","secret","rapid","adequate","fixed","sweet","administrative","wooden","remarkable","comprehensive","surprising","solid","rough","mere","mass","brilliant","maximum","absolute","electronic","visual","electric","cool","spanish","literary","continuing","supreme","chemical","genuine","exciting","written","advanced","extreme","classical","fit","favourite","widespread","confident","straight","proud","numerous","opposite","distinct","mad","helpful","given","disabled","consistent","anxious","nervous","awful","stable","constitutional","satisfied","conscious","developing","strategic","holy","smooth","dominant","remote","theoretical","outstanding","pink","pretty","clinical","minimum","honest","impressive","related","residential","extraordinary","plain","visible","accurate","distant","still","greek","complicated","musical","precise","gentle","broken","live","silly","fat","tight","monetary","round","psychological","violent","unemployed","inevitable","junior","sensible","grateful","pleasant","dirty","structural","welcome","deaf","above","continuous","blind","overseas","mean","entitled","delighted","loose","occasional","evident","desperate","fellow","universal","square","steady","classic","equivalent","intellectual","victorian","level","ultimate","creative","lost","medieval","clever","linguistic","convinced","judicial","raw","sophisticated","asleep","vulnerable","illegal","outer","revolutionary","bitter","changing","australian","native","imperial","strict","wise","informal","flexible","collective","frequent","experimental","spiritual","intense","rational","generous","inadequate","prominent","logical","bare","historic","modest","dutch","acute","electrical","valid","weekly","gross","automatic","loud","reliable","mutual","liable","multiple","ruling","curious","sole","managing","pregnant","latin","nearby","exact","underlying","identical","satisfactory","marginal","distinctive","electoral","urgent","presidential","controversial","everyday","encouraging","organic","continued","expected","statistical","desirable","innocent","improved","exclusive","marked","experienced","unexpected","superb","sheer","disappointed","frightened","gastric","romantic","naked","reluctant","magnificent","convenient","established","closed","uncertain","artificial","diplomatic","tremendous","marine","mechanical","retail","institutional","mixed","required","biological","known","functional","straightforward","superior","digital","spectacular","unhappy","confused","unfair","aggressive","spare","painful","abstract","asian","associated","legislative","monthly","intelligent","hungry","explicit","nasty","just","faint","coloured","ridiculous","amazing","comparable","successive","realistic","back","decent","decentralized","bitcoin","cypherpunk","unnecessary","flying","random","influential","dull","genetic","neat","marvellous","crazy","damp","giant","secure","bottom","skilled","subtle","elegant","brave","lesser","parallel","steep","intensive","casual","tropical","lonely","partial","preliminary","concrete","alleged","assistant","vertical","upset","delicate","mild","occupational","excessive","progressive","exceptional","integrated","striking","continental","okay","harsh","combined","fierce","handsome","characteristic","chronic","compulsory","interim","objective","splendid","magic","systematic","obliged","payable","fun","horrible","primitive","fascinating","ideological","metropolitan","surrounding","estimated","peaceful","premier","operational","technological","kind","advisory","hostile","precious","accessible","determined","excited","impressed","provincial","smart","endless","isolated","drunk","geographical","like","dynamic","boring","forthcoming","unfortunate","definite","super","notable","indirect","stiff","wealthy","awkward","lively","neutral","artistic","content","mature","colonial","ambitious","evil","magnetic","verbal","legitimate","sympathetic","empirical","head","shallow","vague","naval","depressed","shared","added","shocked","mid","worthwhile","qualified","missing","blank","absent","favourable","polish","israeli","developed","profound","representative","enthusiastic","dreadful","rigid","reduced","cruel","coastal","peculiar","swiss","crude","extended","selected","eager","canadian","bold","relaxed","corresponding","running","planned","applicable","immense","allied","comparative","uncomfortable","conservation","productive","beneficial","bored","charming","minimal","mobile","turkish","orange","rear","passive","suspicious","overwhelming","fatal","resulting","symbolic","registered","neighbouring","calm","irrelevant","patient","compact","profitable","rival","loyal","moderate","distinguished","interior","noble","insufficient","eligible","mysterious","varying","managerial","molecular","olympic","linear","prospective","printed","parental","diverse","elaborate","furious","fiscal","burning","useless","semantic","embarrassed","inherent","philosophical","deliberate","awake","variable","promising","unpleasant","varied","sacred","selective","inclined","tender","hidden","worthy","intermediate","sound","protective","fortunate","slim","defensive","divine","stuck","driving","invisible","misleading","circular","mathematical","inappropriate","liquid","persistent","solar","doubtful","manual","architectural","intact","incredible","devoted","prior","tragic","respectable","optimistic","convincing","unacceptable","decisive","competent","spatial","respective","binding","relieved","nursing","toxic","select","redundant","integral","then","probable","amateur","fond","passing","specified","territorial","horizontal","inland","cognitive","regulatory","miserable","resident","polite","scared","gothic","civilian","instant","lengthy","adverse","korean","unconscious","anonymous","aesthetic","orthodox","static","unaware","costly","fantastic","foolish","fashionable","causal","compatible","wee","implicit","dual","ok","cheerful","subjective","forward","surviving","exotic","purple","cautious","visiting","aggregate","ethical","teenage","dying","disastrous","delicious","confidential","underground","thorough","grim","autonomous","atomic","frozen","colourful","injured","uniform","ashamed","glorious","wicked","coherent","rising","shy","novel","balanced","delightful","arbitrary","adjacent","worrying","weird","unchanged","rolling","evolutionary","intimate","sporting","disciplinary","formidable","lexical","noisy","gradual","accused","homeless","supporting","coming","renewed","excess","retired","rubber","chosen","outdoor","embarrassing","preferred","bizarre","appalling","agreed","imaginative","governing","accepted","vocational","mighty","puzzled","worldwide","organisational","sunny","eldest","eventual","spontaneous","vivid","rude","faithful","ministerial","innovative","controlled","conceptual","unwilling","civic","meaningful","alive","brainy","breakable","busy","careful","cautious","clever","concerned","crazy","curious","dead","different","difficult","doubtful","easy","famous","fragile","helpful","helpless","important","impossible","innocent","inquisitive","modern","open","outstanding","poor","powerful","puzzled","real","rich","shy","sleepy","super","tame","uninterested","wandering","wild","wrong","adorable","alert","average","beautiful","blonde","bloody","blushing","bright","clean","clear","cloudy","colorful","crowded","cute","dark","drab","distinct","dull","elegant","fancy","filthy","glamorous","gleaming","graceful","grotesque","homely","light","misty","motionless","muddy","plain","poised","quaint","shiny","smoggy","sparkling","spotless","stormy","strange","ugly","unsightly","unusual","bad","better","beautiful","big","black","blue","bright","clumsy","crazy","dizzy","dull","fat","frail","friendly","funny","great","green","gigantic","gorgeous","grumpy","handsome","happy","horrible","itchy","jittery","jolly","kind","long","lazy","magnificent","magenta","many","mighty","mushy","nasty","new","nice","nosy","nutty","nutritious","odd","orange","ordinary","pretty","precious","prickly","purple","quaint","quiet","quick","quickest","rainy","rare","ratty","red","roasted","robust","round","sad","scary","scrawny","short","silly","stingy","strange","striped","spotty","tart","tall","tame","tan","tender","testy","tricky","tough","ugly","ugliest","vast","watery","wasteful","wonderful","yellow","yummy","zany"],x={gunOnceDefined:function(e){return new Promise((function(t){e.on((function(e,n,r,i){void 0!==e&&(i.off(),t(e))}))}))},getHash:function(e,n){var r=this;return s(i().mark((function a(){var s;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===n&&(n="base64"),e){i.next=3;break}return i.abrupt("return",void 0);case 3:return i.next=5,t.SEA.work(e,void 0,void 0,{name:"SHA-256"});case 5:if(s=i.sent){i.next=8;break}throw new Error("Gun.SEA.work failed for "+e);case 8:if(!(s.length>44)){i.next=10;break}throw new Error("Gun.SEA.work returned an invalid SHA-256 hash longer than 44 chars: "+s+". This is probably due to a sea.js bug on Safari.");case 10:if("hex"!==n){i.next=12;break}return i.abrupt("return",r.base64ToHex(s));case 12:return i.abrupt("return",s);case 13:case"end":return i.stop()}}),a)})))()},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateName:function(){return this.capitalize(g.sample(w))+" "+this.capitalize(g.sample(b))},base64ToHex:function(e){for(var t=atob(e),n="",r=0;r<t.length;r++){var i=t.charCodeAt(r).toString(16);n+=2===i.length?i:"0"+i}return n},getCaret:function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null===t)return 0;var n=e.createTextRange(),r=n.duplicate();return n.moveToBookmark(t.getBookmark()),r.setEndPoint("EndToStart",n),r.text.length}return 0},injectCss:function(){if(!document.getElementById("irisStyle")){var e=document.createElement("style");e.id="irisStyle",e.innerHTML='\n      .iris-follow-button .hover {\n        display: none;\n      }\n\n      .iris-follow-button.following:hover .hover {\n        display: inline;\n      }\n\n      .iris-follow-button.following:hover .nonhover {\n        display: none;\n      }\n\n      .iris-identicon * {\n        box-sizing: border-box;\n      }\n\n      .iris-identicon {\n        vertical-align: middle;\n        border-radius: 50%;\n        text-align: center;\n        display: inline-block;\n        position: relative;\n        max-width: 100%;\n      }\n\n      .iris-distance {\n        z-index: 2;\n        position: absolute;\n        left:0%;\n        top:2px;\n        width: 100%;\n        text-align: right;\n        color: #fff;\n        text-shadow: 0 0 1px #000;\n        font-size: 75%;\n        line-height: 75%;\n        font-weight: bold;\n      }\n\n      .iris-pie {\n        border-radius: 50%;\n        position: absolute;\n        top: 0;\n        left: 0;\n        box-shadow: 0px 0px 0px 0px #82FF84;\n        padding-bottom: 100%;\n        max-width: 100%;\n        -webkit-transition: all 0.2s ease-in-out;\n        -moz-transition: all 0.2s ease-in-out;\n        transition: all 0.2s ease-in-out;\n      }\n\n      .iris-card {\n        padding: 10px;\n        background-color: #f7f7f7;\n        color: #777;\n        border: 1px solid #ddd;\n        display: flex;\n        flex-direction: row;\n        overflow: hidden;\n      }\n\n      .iris-card a {\n        -webkit-transition: color 150ms;\n        transition: color 150ms;\n        text-decoration: none;\n        color: #337ab7;\n      }\n\n      .iris-card a:hover, .iris-card a:active {\n        text-decoration: underline;\n        color: #23527c;\n      }\n\n      .iris-pos {\n        color: #3c763d;\n      }\n\n      .iris-neg {\n        color: #a94442;\n      }\n\n      .iris-identicon img {\n        position: absolute;\n        top: 0;\n        left: 0;\n        max-width: 100%;\n        border-radius: 50%;\n        border-color: transparent;\n        border-style: solid;\n      }\n\n      .iris-chat-open-button {\n        background-color: #1e1e1e;\n        color: #fff;\n        padding: 15px;\n        cursor: pointer;\n        user-select: none;\n      }\n\n      .iris-chat-open-button svg {\n        width: 1em;\n      }\n\n      .iris-chat-open-button, .iris-chat-box {\n        position: fixed;\n        bottom: 0.5rem;\n        right: 0.5rem;\n        border-radius: 8px;\n        font-family: system-ui;\n        font-size: 15px;\n      }\n\n      .iris-chat-box {\n        background-color: #fff;\n        max-height: 25rem;\n        box-shadow: 2px 2px 20px rgba(0, 0, 0, 0.2);\n        height: calc(100% - 44px);\n        display: flex;\n        flex-direction: column;\n        width: 320px;\n        color: rgb(38, 38, 38);\n      }\n\n      .iris-chat-box.minimized {\n        height: auto;\n      }\n\n      .iris-chat-box.minimized .iris-chat-header {\n        border-radius: 8px;\n        cursor: pointer;\n      }\n\n      .iris-chat-box.minimized .iris-chat-messages, .iris-chat-box.minimized .iris-typing-indicator, .iris-chat-box.minimized .iris-chat-input-wrapper, .iris-chat-box.minimized .iris-chat-minimize, .iris-chat-box.minimized .iris-chat-close {\n        display: none;\n      }\n\n      .iris-chat-header {\n        background-color: #1e1e1e;\n        height: 44px;\n        color: #fff;\n        border-radius: 8px 8px 0 0;\n        text-align: center;\n        display: flex;\n        flex-direction: row;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n      }\n\n      .iris-chat-header-text {\n        flex: 1;\n      }\n\n      .iris-online-indicator {\n        color: #bfbfbf;\n        margin-right: 5px;\n        font-size: 12px;\n        user-select: none;\n        flex: none;\n      }\n\n      .iris-online-indicator.yes {\n        color: #80bf5f;\n      }\n\n      .iris-typing-indicator {\n        display: none;\n        background-color: rgba(255, 255, 255, 0.5);\n        font-size: 12px;\n        padding: 2px;\n        color: #777;\n      }\n\n      .iris-typing-indicator.yes {\n        display: block;\n      }\n\n      .iris-chat-messages {\n        flex: 1;\n        padding: 15px;\n        overflow-y: scroll;\n      }\n\n      .iris-chat-input-wrapper {\n        flex: none;\n        padding: 15px;\n        background-color: #efefef;\n        display: flex;\n        flex-direction: row;\n        border-radius: 0 0 8px 8px;\n      }\n\n      .iris-chat-input-wrapper textarea {\n        padding: 15px 8px;\n        border-radius: 4px;\n        border: 1px solid rgba(0,0,0,0);\n        width: auto;\n        font-size: 15px;\n        resize: none;\n        flex: 1;\n      }\n\n      .iris-chat-input-wrapper textarea:focus {\n        outline: none;\n        border: 1px solid #6dd0ed;\n      }\n\n      .iris-chat-input-wrapper button svg {\n        display: inline-block;\n        font-size: inherit;\n        height: 1em;\n        width: 1em;\n        overflow: visible;\n        vertical-align: -0.125em;\n      }\n\n      .iris-chat-input-wrapper button, .iris-chat-input-wrapper button:hover, .iris-chat-input-wrapper button:active, .iris-chat-input-wrapper button:focus {\n        flex: none;\n        color: #999;\n        background-color: transparent;\n        font-size: 30px;\n        padding: 5px;\n        border: 1px solid rgba(0,0,0,0);\n        border-radius: 4px;\n        margin-left: 5px;\n      }\n\n      .iris-chat-input-wrapper button:active, .iris-chat-input-wrapper button:focus {\n        outline: none;\n        border: 1px solid #6dd0ed;\n      }\n\n      .iris-chat-message {\n        display: flex;\n        flex-direction: column;\n        margin-bottom: 2px;\n        overflow-wrap: break-word;\n      }\n\n      .iris-msg-content {\n        background-color: #efefef;\n        padding: 6px 10px;\n        border-radius: 8px;\n        box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.1);\n        flex: none;\n        max-width: 75%;\n      }\n\n      .emoji {\n        font-size: 1.3em;\n        line-height: 1em;\n      }\n\n      .iris-chat-message .emoji-only {\n        font-size: 3em;\n        text-align: center;\n      }\n\n      .iris-seen {\n        color: rgba(0, 0, 0, 0.45);\n        user-select: none;\n      }\n\n      .iris-seen.yes {\n        color: #4fc3f7;\n      }\n\n      .iris-seen svg {\n        width: 18px;\n      }\n\n      .iris-delivered-checkmark {\n        display: none;\n      }\n\n      .delivered .iris-delivered-checkmark {\n        display: initial;\n      }\n\n      .iris-chat-minimize, .iris-chat-close {\n        user-select: none;\n        cursor: pointer;\n        width: 45px;\n        line-height: 44px;\n      }\n\n      .iris-chat-message.their {\n        align-items: flex-start;\n      }\n\n      .iris-chat-message.their + .iris-chat-message.our .iris-msg-content, .day-separator + .iris-chat-message.our .iris-msg-content {\n        margin-top: 15px;\n        border-radius: 8px 0px 8px 8px;\n      }\n\n      .iris-chat-message.their:first-of-type .iris-msg-content {\n        border-radius: 0px 8px 8px 8px;\n      }\n\n      .iris-chat-message.our:first-of-type .iris-msg-content {\n        border-radius: 8px 0px 8px 8px;\n      }\n\n      .iris-chat-message.our + .iris-chat-message.their .iris-msg-content, .day-separator + .iris-chat-message.their .iris-msg-content {\n        margin-top: 15px;\n        border-radius: 0px 8px 8px 8px;\n      }\n\n      .iris-chat-message.our {\n        align-items: flex-end;\n      }\n\n      .iris-chat-message.our .iris-msg-content {\n        background-color: #c5ecf7;\n      }\n\n      .iris-chat-message .time {\n        text-align: right;\n        font-size: 12px;\n        color: rgba(0, 0, 0, 0.45);\n      }\n\n      .iris-non-string {\n        color: blue;\n      }\n\n      .day-separator {\n        display: inline-block;\n        border-radius: 8px;\n        background-color: rgba(227, 249, 255, 0.91);\n        padding: 6px 10px;\n        margin-top: 15px;\n        margin-left: auto;\n        margin-right: auto;\n        text-transform: uppercase;\n        font-size: 13px;\n        color: rgba(74, 74, 74, 0.88);\n        box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.1);\n        user-select: none;\n      }\n\n      .day-separator:first-of-type {\n        margin-top: 0;\n      }\n\n      *[contenteditable="true"]:not(:focus) {\n        cursor: pointer;\n      }\n\n      *[contenteditable="true"] {\n        outline: none;\n      }\n\n      [placeholder]:empty:before {\n        content: attr(placeholder);\n        color: #999;\n      }\n\n      [placeholder]:empty:focus {\n        cursor: text;\n      }\n      ',document.head.prepend(e)}},getUrlParameter:function(e,t){var n,r,i=(t||window.location.search.substring(1)).split("&");for(r=0;r<i.length;r++)if((n=i[r].split("="))[0]===e)return void 0===n[1]||decodeURIComponent(n[1])},formatTime:function(e){var t=e.toLocaleTimeString(void 0,{timeStyle:"short"}),n=t.split(":");return 3===n.length?n[0]+":"+n[1]+n[2].slice(2):t},formatDate:function(e){var t=e.toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}),n=t.split(":");return 3===n.length?n[0]+":"+n[1]+n[2].slice(2):t},getDaySeparatorText:function(e,t,n,r){if(n||(r=(n=new Date).toLocaleDateString({dateStyle:"short"})),t===r)return"today";var i=Math.round((n-e)/864e5);return 0===i?"today":1===i?"yesterday":i<=5?e.toLocaleDateString(void 0,{weekday:"long"}):t},getProfileLink:function(e){return window.location.origin+"/#/profile/"+encodeURIComponent(e)},truncateString:function(e,t){return void 0===t&&(t=30),e.length>t?e.slice(0,t)+"...":e},createElement:function(e,t,n){var r=document.createElement(e);return t&&r.setAttribute("class",t),n&&n.appendChild(r),r},isNode:m,isElectron:y,isMobile:!m&&function(){if(y)return!1;var e,t=!1;return e=navigator.userAgent||navigator.vendor||"",(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}(),throttle:function(e,t){var n;return function(){var r=arguments,i=this;n||(e.apply(i,r),n=!0,setTimeout((function(){return n=!1}),t))}},debounce:function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout((function(){return e.apply(r,i)}),t)}},sample:function(e){return e[Math.floor(Math.random()*e.length)]},sampleSize:function(e,t){for(var n,r,i=e.slice(0),a=e.length,s=a-t;a-- >s;)n=i[r=Math.floor((a+1)*Math.random())],i[r]=i[a],i[a]=n;return i.slice(s)},defer:function(e){return setTimeout(e,0)},once:function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},omit:function(e,t){var n={};return Object.keys(e).forEach((function(r){t.includes(r)||(n[r]=e[r])})),n}},k="http://localhost:8767/gun",S={"https://gun-rs.iris.to/gun":{},"https://gun-us.herokuapp.com/gun":{}},A=window.location,E=A.host,T=E.startsWith("localhost")&&"localhost:8080"!==E;(A.hostname.endsWith("herokuapp.com")||T)&&(Object.keys(S).forEach((function(e){return S[e].enabled=!1})),S[A.origin+"/gun"]={enabled:!0});var M=/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/,O={known:{},add:function(e){var n=this;return s(i().mark((function r(){var a,s,o,u;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.url||M.test(e.url)){r.next=2;break}throw new Error("Invalid url "+e.url);case 2:if(e.from&&Object.keys(n.known).forEach((function(t){n.known[t].from===e.from&&delete n.known[t]})),n.known[a=e.url||""]=n.known[a]||g.omit(e,["url"]),"public"!==e.visibility){r.next=19;break}return r.next=8,t.SEA.secret(_e.getKey().epub,_e.getKey());case 8:if(r.t0=r.sent,r.t0){r.next=11;break}r.t0="";case 11:return s=r.t0,r.next=14,t.SEA.encrypt(e.url,s);case 14:return o=r.sent,r.next=17,t.SEA.work(o,null,null,{name:"SHA-256"});case 17:u=r.sent,G().user().get("peers").get(u).put({url:e.url,lastSeen:(new Date).toISOString()});case 19:!1!==e.enabled?e.url&&n.connect(e.url):n.save();case 20:case"end":return r.stop()}}),r)})))()},remove:function(e){delete this.known[e],this.save()},disconnect:function(e){G().on("bye",e),e.url=""},save:function(){localStorage.setItem("gunPeers",JSON.stringify(this.known))},getSaved:function(){var e=localStorage.getItem("gunPeers");return e=e&&"undefined"!==e?JSON.parse(e):S,x.isElectron&&(e[k]={}),Object.keys(e).forEach((function(t){return g.defaults(e[t],{enabled:!0})})),e},reset:function(){localStorage.setItem("gunPeers",""),this.known=this.getSaved()},connect:function(e){this.isMixedContent(e)||(this.known[e]?(this.known[e].enabled=!0,G().opt({peers:[e]}),this.save()):this.add({url:e}))},disable:function(e,t){this.known[e].enabled=!1,t&&this.disconnect(t),this.save()},isMixedContent:function(e){return"https:"===window.location.protocol&&0===e.indexOf("http:")},random:function(){var e=this,t=x.isElectron&&this.known[k]&&!1!==this.known[k].enabled,n=t?Math.max(1,1):2,r=g.sampleSize(Object.keys(g.pickBy(this.known,(function(t,n){return!e.isMixedContent(n)&&t.enabled&&!(x.isElectron&&n===k)}))),n);return r&&t&&r.push(k),r},checkGunPeerCount:function(){},init:function(){var e=this;this.known=this.getSaved(),setInterval((function(){return e.checkGunPeerCount()}),1e3)}},j=function(){function e(e){void 0===e&&(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))),this.id=e}var t=e.prototype;return t.handle=function(e){throw new Error("not implemented")},t.postMessage=function(e){this.handle(e)},e}();function C(){return Math.random().toString(36).slice(2,10)}var I,L=function(){function e(e,t,n,r,i,a,s){this.type="get",this.id=e,this.from=n,this.nodeId=t,this.recipients=r,this.childKey=i,this.jsonStr=a,this.checksum=s}return e.prototype.serialize=function(){if(this.jsonStr)return this.jsonStr;var e={get:{"#":this.nodeId},"#":this.id};return this.childKey&&(e.get["."]=this.childKey),this.jsonStr=JSON.stringify(e),this.jsonStr},e.deserialize=function(t,n){var r=JSON.parse(t);return new e(r["#"],r.get["#"],n,void 0,r.get["."],t)},e.fromObject=function(t){return new e(t.id,t.nodeId,t.from,t.recipients,t.childKey,t.jsonStr,t.checksum)},e.new=function(t,n,r,i,a,s){return new e(C(),t,n,r,i,a,s)},e}(),P=function(){function e(e,t,n,r,i,a,s){this.type="put",this.id=e,this.from=n,this.updatedNodes=t,this.inResponseTo=r,this.recipients=i,this.jsonStr=a,this.checksum=s}return e.prototype.deserialize=function(){return JSON.stringify(this)},e.fromObject=function(t){return new e(t.id,t.updatedNodes,t.from,t.inResponseTo,t.recipients,t.jsonStr,t.checksum)},e.new=function(t,n,r,i,a,s){return new e(C(),t,n,r,i,a,s)},e.newFromKv=function(t,n,r){var i={};return i[t]=n,e.new(i,r)},e}(),D=function(e){function t(t){var r;return void 0===t&&(t={}),(r=e.call(this)||this).throttledPut=g.throttle((function(){var e=Object.keys(r.putQueue),t=e.map((function(e){return r.putQueue[e]}));r.db.nodes.bulkPut(t,e),r.putQueue={}}),500),r.throttledGet=g.throttle((function(){var e=r.getQueue,t=Object.keys(e);r.db.nodes.bulkGet(t).then((function(n){for(var r=0;r<t.length;r++)for(var i,a=n[r],s=d(e[t[r]]);!(i=s()).done;)(0,i.value)(a)})),r.getQueue={}}),100),r.config=t,r.notStored=new Set,r.putQueue={},r.getQueue={},r.i=0,r.db=new n(t.dbName||"iris"),r.db.version(1).stores({nodes:",value"}),r.db.open().catch((function(e){console.error(e.stack||e)})),r}o(t,e);var r=t.prototype;return r.put=function(e,t){this.putQueue[e]=t,this.throttledPut()},r.get=function(e,t){this.getQueue[e]=this.getQueue[e]||[],this.getQueue[e].push(t),this.throttledGet()},r.handle=function(e){this.queue=this.queue&&this.queue++||1,this.queue>10||(e instanceof P?this.handlePut(e):e instanceof L?this.handleGet(e):console.log("worker got unknown message",e))},r.handleGet=function(e){var t=this;this.notStored.has(e.nodeId)||this.get(e.nodeId,(function(n){if(void 0===n)t.notStored.add(e.nodeId);else{var r=P.newFromKv(e.nodeId,n,t.id);r.inResponseTo=e.id,e.from&&e.from.postMessage(r)}}))},r.mergeAndSave=function(e,t){var n=this;this.get(e,(function(r){void 0===r?n.put(e,t):g.isEqual(r,t)||(Array.isArray(r)&&Array.isArray(t)&&(t=g.uniq(r.concat(t))),Array.isArray(t)&&0===t.length&&console.log("no kids",e),n.put(e,t))}))},r.savePath=function(e,t){void 0===t?(this.db.nodes.delete(e),this.notStored.add(e)):(this.notStored.delete(e),this.mergeAndSave(e,t))},r.handlePut=function(){var e=s(i().mark((function e(t){var n,r,a,s,o,u,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,r=Object.entries(t.updatedNodes);case 1:if(!(n<r.length)){e.next=13;break}if(s=(a=r[n])[0],o=a[1]){e.next=6;break}return console.log("deleting",s),e.abrupt("continue",10);case 6:if("object"==typeof o){e.next=9;break}return this.savePath(s,o),e.abrupt("continue",10);case 9:for(u=0,c=Object.entries(o);u<c.length;u++)this.savePath(s+"/"+(l=c[u])[0],l[1]);case 10:n++,e.next=1;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(j);global.onconnect=function(){I?console.log("worker already exists"):(console.log("starting worker"),I=I||new D)};var z,K=function(e){function t(t){var n;return void 0===t&&(t={}),(n=e.call(this,"router")||this).storageAdapters=new Set,n.networkAdapters=new Set,n.serverPeers=new Set,n.seenMessages=new Set,n.seenGetMessages=new Map,n.subscribersByTopic=new Map,n.msgCounter=0,n.storageAdapters.add(new D(t)),n}o(t,e);var n=t.prototype;return n.handle=function(e){this.seenMessages.has(e.id)||(this.seenMessages.add(e.id),e instanceof P?this.handlePut(e):e instanceof L&&this.handleGet(e))},n.handlePut=function(e){var t=this;Object.keys(e.updatedNodes).forEach((function(n){for(var r,i=n.split("/")[1]||"",a=t.subscribersByTopic.get(i),s=d(t.storageAdapters);!(r=s()).done;)r.value.postMessage(e);if(a)for(var o,u=d(a);!(o=u()).done;){var c=o.value;c[0]!==e.from&&c[1].postMessage(e)}}))},n.handleGet=function(e){for(var t,n=e.nodeId.split("/")[1],r=d(this.storageAdapters);!(t=r()).done;)t.value.postMessage(e);this.subscribersByTopic.has(n)||this.subscribersByTopic.set(n,new Map);for(var i,a=this.subscribersByTopic.get(n),s=d(a);!(i=s()).done;){var o=i.value;o[0]!==e.from.id&&o[1].postMessage(e)}a.has(e.from.id)||a.set(e.from.id,e.from)},t}(j);self.onconnect=function(){console.log("router shared worker connected"),z=z||new K};var N,_={allowPublicSpace:!1,enableStats:!0,localOnly:!0},U=function(e){function t(t,n,r){var i;return void 0===t&&(t=""),(i=e.call(this,t)||this).children=new Map,i.once_subscriptions=new Map,i.on_subscriptions=new Map,i.map_subscriptions=new Map,i.value=void 0,i.counter=0,i.loaded=!1,i.doCallbacks=g.throttle((function(){for(var e,t=function(){var t=e.value,n=t[0],r={off:function(){return i.on_subscriptions.delete(n)}};i.once(t[1],r,!1)},n=d(i.on_subscriptions);!(e=n()).done;)t();for(var r,a=d(i.once_subscriptions);!(r=a()).done;){var s=r.value,o=s[0];i.once(s[1],void 0,!1),i.once_subscriptions.delete(o)}if(i.parent){for(var u,c=function(){var e=u.value,t=e[0];i.parent.once(e[1],{off:function(){var e;return null==(e=i.parent)?void 0:e.on_subscriptions.delete(t)}},!1)},l=d(i.parent.on_subscriptions);!(u=l()).done;)c();for(var p,h=function(){var e=p.value,t=e[0];i.once(e[1],{off:function(){var e;return null==(e=i.parent)?void 0:e.map_subscriptions.delete(t)}},!1)},f=d(i.parent.map_subscriptions);!(p=f()).done;)h()}}),40),i.parent=r,i.config=n||r&&r.config||_,r?(i.root=r.root,i.router=r.router):(i.root=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),i.router=new K({dbName:i.id+"-idb"})),i}o(t,e);var n=t.prototype;return n.getCurrentUser=function(){return this.parent?this.parent.getCurrentUser():this.currentUser},n.setCurrentUser=function(e){this.parent?this.parent.setCurrentUser(e):this.currentUser=e},n.handle=function(e){var t=this;if(e instanceof P){for(var n=0,r=Object.entries(e.updatedNodes);n<r.length;n++){var i=r[n],a=i[1];i[0]===this.id&&(this.loaded=!0,Array.isArray(a)?a.forEach((function(e){return t.get(e)})):this.value=a,this.parent&&this.parent.handle(e))}setTimeout((function(){return t.doCallbacks()}),100)}},n.get=function(e){var n=this.children.get(e);if(n)return n;var r=new t(this.id+"/"+e,this.config,this);return this.children.set(e,r),r},n.user=function(e){if(!(e=e||this.root.currentUser&&this.root.currentUser.pub))throw new Error("no public key!");return this.get("users").get(e)},n.auth=function(e){this.root.currentUser=e,this.root.setCurrentUser(e)},n.put=function(e){if(this.value!==e){if(Array.isArray(e))throw new Error("put() does not support arrays");if("function"==typeof e)throw new Error("put() does not support functions");if("object"!=typeof e||null===e){this.children=new Map,this.value=e,this.doCallbacks();var t={};t[this.id]=e,this.addParentNodes(t),this.router.postMessage(P.new(t,this))}else for(var n in this.value=void 0,e)this.get(n).put(e[n])}},n.addParentNodes=function(e){if(this.parent){this.parent.value=void 0;for(var t,n={},r=d(this.parent.children);!(t=r()).done;){var i=t.value,a=i[0],s=i[1];a&&a.indexOf?s.children.size>0?n[a]=Array.from(s.children.keys()):void 0!==s.value&&(n[a]=s.value):this.parent.children.delete(a)}e[this.parent.id]=n,this.parent.addParentNodes(e)}},n.once=function(){var e=s(i().mark((function e(t,n,r){var a,o,u=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),this.loaded||this.router.postMessage(L.new(this.id,this)),!this.children.size){e.next=8;break}return a={},e.next=6,Promise.all(Array.from(this.children.keys()).map(function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.get(t).once(null,n);case 2:a[t]=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:e.next=9;break;case 8:void 0!==this.value?a=this.value:r&&(o=this.counter++,t&&this.once_subscriptions.set(o,t));case 9:if(void 0===a&&!r){e.next=13;break}return t&&t(a,this.id.slice(this.id.lastIndexOf("/")+1),null,n),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.on=function(e){var t=this,n=this.counter++;this.on_subscriptions.set(n,e),this.once(e,{off:function(){return t.on_subscriptions.delete(n)}},!1)},n.map=function(e){var t=this,n=this.counter++;this.map_subscriptions.set(n,e);for(var r,i={off:function(){return t.map_subscriptions.delete(n)}},a=d(this.children.values());!(r=a()).done;)r.value.once(e,i,!1)},t}(j);function G(e){if(void 0===e&&(e={}),!N){var t=Object.assign({peers:e.peers||O.random(),localStorage:!1,retry:Infinity},e);e.peers&&e.peers.forEach((function(e){return O.add({url:e})})),O.init(),N=new U("global",t)}return N}var q={email:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,bitcoin:/^[13][a-km-zA-HJ-NP-Z0-9]{26,33}$/,bitcoin_address:/^[13][a-km-zA-HJ-NP-Z0-9]{26,33}$/,ip:/^(([1-9]?\d|1\d\d|2[0-5][0-5]|2[0-4]\d)\.){3}([1-9]?\d|1\d\d|2[0-5][0-5]|2[0-4]\d)$/,ipv6:/^(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}$/,gpg_fingerprint:null,gpg_keyid:null,google_oauth2:null,tel:/^\d{7,}$/,phone:/^\d{7,}$/,keyID:null,url:/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,account:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,uuid:/[0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12}/},R=function(){function e(t,n){if("object"==typeof t){if("string"!=typeof t.value)throw new Error("param1.value must be a string, got "+typeof t.value+": "+JSON.stringify(t.value));if("string"!=typeof t.type)throw new Error("param1.type must be a string, got "+typeof t.type+": "+JSON.stringify(t.type));n=t.value,t=t.type}if("string"!=typeof t)throw new Error("First param must be a string, got "+typeof t+": "+JSON.stringify(t));if(!t.length)throw new Error("First param string is empty");if(n){if("string"!=typeof n)throw new Error("Second parameter must be a string, got "+typeof n+": "+JSON.stringify(n));if(!n.length)throw new Error("Second param string is empty");this.type=t,this.value=n}else{this.value=t;var r=e.guessTypeOf(this.value);if(!r)throw new Error("Type of attribute was omitted and could not be guessed");this.type=r}}e.getUuid=function(){return new e("uuid",function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}())},e.getUniqueIdValidators=function(){return q},e.isUniqueType=function(e){return Object.keys(q).indexOf(e)>-1};var t=e.prototype;return t.isUniqueType=function(){return e.isUniqueType(this.type)},e.guessTypeOf=function(e){for(var t in q)if(e.match(q[t]))return t},e.equals=function(e,t){return e.equals(t)},t.equals=function(e){return e&&this.type===e.type&&this.value===e.value},t.uri=function(){return encodeURIComponent(this.value)+":"+encodeURIComponent(this.type)},e}();function H(e){if(void 0===e&&(e=_e.getKey()),"string"==typeof e)return G().user(e);if("object"==typeof e){var t=G().user(e.pub);return t.auth(e),t}}var F,W={read:!0,write:!0,admin:!1},J=function(){function e(e){var t=this;if(this.theirSecretUuids={},this.theirGroupSecrets={},this.secrets={},this.ourSecretChannelIds={},this.theirSecretChannelIds={},this.messages={},this.chatLinks={},this.groupSubscriptions={},this.directSubscriptions={},this.getParticipantsCallbacks={},this.myGroupSecret=e.myGroupSecret,e.chatLink&&this.useChatLink(e),"string"==typeof e.participants)this.addParticipant(e.participants,e.save);else if(Array.isArray(e.participants)){var n={};e.participants.forEach((function(e){return n[e]=Object.assign({},W)})),e.participants=n}"object"==typeof e.participants&&(Object.keys(e.participants).forEach((function(n){n!==_e.getKey().pub&&t.addParticipant(n,e.save,Object.assign({},W,e.participants[n]))})),e.participants[_e.getKey().pub]=e.participants[_e.getKey().pub]||Object.assign({},W),e.uuid?(this.uuid=e.uuid,this.name=e.name):(e.uuid=R.getUuid().value,this.uuid=e.uuid,e.participants[_e.getKey().pub].admin=!0,e.participants[_e.getKey().pub].founder=!0),this.getChatLinks({subscribe:!0})),this.participants=e.participants,e.uuid&&(this.putDirect("S"+this.uuid,this.getMyGroupSecret()),this.getMySecretUuid().then((function(e){t.putDirect(t.uuid,e)})),this.onTheirDirect(this.uuid,(function(e,n,r){t.theirSecretUuids[r]=e})),this.onTheirDirect("S"+this.uuid,(function(e,n,r){t.theirGroupSecrets[r]=e}))),this.onTheir("participants",(function(n,r,i){for(var a=!1,s=Object.keys(t.participants),o=0;o<s.length;o++)if(t.participants[s[o]].admin||t.participants[s[o]].inviter){a=!0;break}if(a||s.forEach((function(e){return t.participants[e].admin=!0})),t.participants[i]&&(t.participants[i].admin||t.participants[i].inviter)&&"object"==typeof n){if(JSON.stringify(t.participants)===JSON.stringify(n))return;t.participants=n,delete t.participants[i].inviter,Object.keys(n).forEach((function(e){e!==_e.getKey().pub&&t.addParticipant(e,!0,Object.assign({},W,n[e]),!0)})),t.participantsChanged(),e.saved=!0}})),e.saved||void 0!==e.save&&!0!==e.save||this.save()}var n=e.prototype;return n.useChatLink=function(e){var n=e.chatLink.split("?");if(2===n.length){var r=x.getUrlParameter("chatWith",n[1]),a=x.getUrlParameter("channelId",n[1]),o=x.getUrlParameter("inviter",n[1]),u=o||r;if(r?e.participants=u:a&&o&&o!==_e.getKey().pub&&(e.uuid=a,e.participants={},e.participants[o]=Object.assign({inviter:!0},W)),u!==_e.getKey().pub){var c=x.getUrlParameter("s",n[1]),l=x.getUrlParameter("k",n[1]);c&&l&&(this.save(),e.saved=!0,G().user(u).get("chatLinks").get(l).get("encryptedSharedKey").on(function(){var e=s(i().mark((function e(n){var r,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.decrypt(n,c);case 2:return r=e.sent,e.next=5,t.SEA.encrypt(_e.getKey().pub,c);case 5:return a=e.sent,e.next=8,x.getHash(a);case 8:s=e.sent,G(r).get("chatRequests").get(s.slice(0,12)).put(a);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}}},n.getTheirSecretUuid=function(e){var t=this;return new Promise((function(n){t.theirSecretUuids[e]?n(t.theirSecretUuids[e]):t.onTheirDirect(t.uuid,(function(r){t.theirSecretUuids[e]=r,n(t.theirSecretUuids[e])}),e)}))},n.getTheirGroupSecret=function(e){var t=this;return e===_e.getKey().pub?this.getMyGroupSecret():new Promise((function(n){t.theirGroupSecrets[e]?n(t.theirGroupSecrets[e]):t.onTheirDirect("S"+t.uuid,(function(r){t.theirGroupSecrets[e]=r,n(t.theirGroupSecrets[e])}),e)}))},n.changeMyGroupSecret=function(){this.myGroupSecret=t.SEA.random(32).toString("base64"),this.putDirect("S"+this.uuid,this.myGroupSecret)},n.mute=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G().user(t).get(this.theirSecretUuids[t]).off();case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.block=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mute(t),this.putDirect(this.uuid,null),this.putDirect("S"+this.uuid,null),delete this.secrets[t],delete this.ourSecretChannelIds[t],delete this.theirSecretChannelIds[t],this.changeMyGroupSecret();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMySecretUuid=function(){var e=s(i().mark((function e(){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mySecretUuid){e.next=10;break}return e.next=3,t.SEA.secret(_e.getKey().epub,_e.getKey());case 3:return n=e.sent,e.next=6,x.getHash(n);case 6:return r=e.sent,e.next=9,x.getHash(r+this.uuid);case 9:this.mySecretUuid=e.sent;case 10:return e.abrupt("return",this.mySecretUuid);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getCurrentParticipants=function(){return Object.keys(this.secrets)},n.getParticipants=function(e){this.getParticipantsCallbackId?this.getParticipantsCallbackId++:this.getParticipantsCallbackId=1,this.getParticipantsCallbacks[this.getParticipantsCallbackId]=e,this.participants&&e(this.participants)},n.participantsChanged=function(){var e=this;Object.keys(this.getParticipantsCallbacks).forEach((function(t){e.getParticipantsCallbacks[t](e.participants)}))},n.getId=function(){return this.uuid||this.getCurrentParticipants()[0]},n.getSecret=function(){var e=s(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.secrets[n]){e.next=7;break}return e.next=3,x.gunOnceDefined(G().user(n).get("epub"));case 3:return r=e.sent,e.next=6,t.SEA.secret(r,_e.getKey());case 6:this.secrets[n]=e.sent;case 7:return e.abrupt("return",this.secrets[n]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.getOurSecretChannelId=function(){var e=s(i().mark((function e(n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.gunOnceDefined(G().user(n).get("epub"));case 2:return a=e.sent,e.next=5,t.SEA.secret(a,r);case 5:return e.abrupt("return",x.getHash(e.sent+n));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.getTheirSecretChannelId=function(){var e=s(i().mark((function e(n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.gunOnceDefined(G().user(n).get("epub"));case 2:return a=e.sent,e.next=5,t.SEA.secret(a,r);case 5:return e.abrupt("return",x.getHash(e.sent+r.pub));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.getChannels=function(){var n=s(i().mark((function n(r,a){var o,u,c,l;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===a&&(a=!0),o=_e.getKey(),n.next=4,t.SEA.secret(o.epub,o);case 4:u=n.sent,a&&e.getMyChatLinks(void 0,void 0,!0),c={},l=function(){var n=s(i().mark((function n(a,s){var l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!a||c[s]){n.next=14;break}if(c[s]=!0,!(s.length>44)){n.next=5;break}return G().user().get("chats").get(s).put(null),n.abrupt("return");case 5:return n.next=7,x.gunOnceDefined(G().user().get("chats").get(s).get("pub"));case 7:return l=n.sent,n.next=10,t.SEA.decrypt(l,u);case 10:if(p=n.sent){n.next=13;break}return n.abrupt("return");case 13:p.pub||"string"==typeof p?r(new e({key:o,participants:p.pub||p,save:!1})):p.uuid&&p.participants&&p.myGroupSecret&&r(new e({key:o,participants:p.participants,uuid:p.uuid,myGroupSecret:p.myGroupSecret,save:!1}));case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),G().user().get("chats").map(l);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),n.getMyGroupSecret=function(){return this.myGroupSecret||this.changeMyGroupSecret(),this.myGroupSecret},n.getOurSecretChannelId=function(){var e=s(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ourSecretChannelIds[t]){e.next=7;break}return e.next=3,this.getSecret(t);case 3:return n=e.sent,e.next=6,x.getHash(n+t);case 6:this.ourSecretChannelIds[t]=e.sent;case 7:return e.abrupt("return",this.ourSecretChannelIds[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getTheirSecretChannelId=function(){var e=s(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.theirSecretChannelIds[t]){e.next=7;break}return e.next=3,this.getSecret(t);case 3:return n=e.sent,e.next=6,x.getHash(n+_e.getKey().pub);case 6:this.theirSecretChannelIds[t]=e.sent;case 7:return e.abrupt("return",this.theirSecretChannelIds[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMessages=function(){var e=s(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getCurrentParticipants().forEach(function(){var e=s(i().mark((function e(n){var a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n===_e.getKey().pub){e.next=11;break}if(!r.uuid){e.next=7;break}return e.next=4,r.getTheirSecretUuid(n);case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,r.getTheirSecretChannelId(n);case 9:a=e.sent;case 10:G().user(n).get("chats").get(a).get("msgs").map().once((function(e,i){r.messageReceived(t,e,r.uuid||n,!1,i,n)}));case 11:if(r.uuid){e.next=16;break}return e.next=14,r.getOurSecretChannelId(n);case 14:s=e.sent,H().get("chats").get(s).get("msgs").map().once((function(e,i){r.messageReceived(t,e,n,!0,i,_e.getKey().pub)}));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!this.uuid){e.next=6;break}return e.next=4,this.getMySecretUuid();case 4:n=e.sent,H().get("chats").get(n).get("msgs").map().once((function(e,n){r.messageReceived(t,e,r.uuid,!0,n,_e.getKey().pub)}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.messageReceived=function(){var e=s(i().mark((function e(n,r,a,s,o,u){var c,l,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messages[o]&&r){e.next=2;break}return e.abrupt("return");case 2:if(!this.uuid){e.next=8;break}return e.next=5,this.getTheirGroupSecret(u);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.getSecret(a);case 10:e.t0=e.sent;case 11:return c=e.t0,e.next=14,t.SEA.decrypt(r,c);case 14:if("object"==typeof(l=e.sent)){e.next=17;break}return e.abrupt("return");case 17:p={selfAuthored:s,channelId:a,from:u},this.messages[o]=l,n(l,p);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),n.getLatestMsg=function(){var e=s(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){var e=s(i().mark((function e(n,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.latest?("string"==typeof r.latest.time?r.latest.time:r.latest.time.toISOString())<n.time&&(r.latest=n,t(n,a)):(r.latest=n,t(n,a));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.onMy("latestMsg",(function(e){return n(e,{selfAuthored:!0,from:_e.getKey().pub})})),this.onTheir("latestMsg",(function(e,t,r){return n(e,{selfAuthored:!1,from:r})}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setMyMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||(new Date).toISOString(),e.abrupt("return",this.put("msgsLastSeenTime",t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMyMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){var n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.onMy("msgsLastSeenTime",(function(e){n.myMsgsLastSeenTime=e,t&&t(n.myMsgsLastSeenTime)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getTheirMsgsLastSeenTime=function(){var e=s(i().mark((function e(t){var n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.onTheir("msgsLastSeenTime",(function(e){n.theirMsgsLastSeenTime=e,t&&t(n.theirMsgsLastSeenTime)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.removeParticipant=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.addParticipant(t,!0,{read:!1,write:!1});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.addParticipant=function(){var e=s(i().mark((function e(n,r,a,s){var o,u,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),!this.uuid){e.next=3;break}return e.abrupt("return");case 3:if(void 0===a&&(a=W),!this.secrets[n]||JSON.stringify(this.secrets[n])!==JSON.stringify(a)){e.next=6;break}return e.abrupt("return");case 6:return this.secrets[n]=null,this.getSecret(n),e.next=10,this.getOurSecretChannelId(n);case 10:if(o=e.sent,!r){e.next=20;break}return e.next=14,t.SEA.secret(_e.getKey().epub,_e.getKey());case 14:return u=e.sent,e.t0=G().user().get("chats").get(o).get("pub"),e.next=18,t.SEA.encrypt({pub:n},u);case 18:e.t1=e.sent,e.t0.put.call(e.t0,e.t1);case 20:this.uuid&&(this.participants[n]=a,r&&(this.putDirect("S"+this.uuid,this.getMyGroupSecret()),this.getMySecretUuid().then((function(e){c.putDirect(c.uuid,e)})),this.onTheirDirect(this.uuid,(function(e,t,n){c.theirSecretUuids[n]=e})),this.onTheirDirect("S"+this.uuid,(function(e,t,n){c.theirGroupSecrets[n]=e})),this.save())),s&&(Object.values(this.directSubscriptions).forEach((function(e){e.forEach((function(e){e.from&&e.from!==n||c._onTheirDirectFromUser(n,e.key,e.callback)}))})),Object.values(this.groupSubscriptions).forEach((function(e){e.forEach((function(e){e.from&&e.from!==n||(a.write?c._onTheirGroupFromUser(n,e.key,e.callback):e.event&&e.event.off())}))})));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.send=function(){var e=s(i().mark((function e(n){var r,a,s,o,u,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof n){e.next=7;break}if(0!==(n=n.trim()).length){e.next=4;break}return e.abrupt("return");case 4:n={time:(new Date).toISOString(),text:n},e.next=12;break;case 7:if("object"!=typeof n){e.next=11;break}n.time=n.time||(new Date).toISOString(),e.next=12;break;case 11:throw new Error("msg param must be a string or an object");case 12:if(!this.uuid){e.next=23;break}return e.next=15,t.SEA.encrypt(JSON.stringify(n),this.getMyGroupSecret());case 15:return r=e.sent,e.next=18,this.getMySecretUuid();case 18:a=e.sent,H().get("chats").get(a).get("msgs").get(""+n.time).put(r),H().get("chats").get(a).get("latestMsg").put(r),e.next=42;break;case 23:s=this.getCurrentParticipants(),o=0;case 25:if(!(o<s.length)){e.next=42;break}return e.t0=t.SEA,e.t1=JSON.stringify(n),e.next=30,this.getSecret(s[o]);case 30:return e.t2=e.sent,e.next=33,e.t0.encrypt.call(e.t0,e.t1,e.t2);case 33:return u=e.sent,e.next=36,this.getOurSecretChannelId(s[o]);case 36:c=e.sent,H().get("chats").get(c).get("msgs").get(""+n.time).put(u),H().get("chats").get(c).get("latestMsg").put(u);case 39:o++,e.next=25;break;case 42:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.save=function(){var e=s(i().mark((function e(){var n,r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.uuid){e.next=17;break}return e.next=3,this.getMySecretUuid();case 3:return n=e.sent,H().get("chats").get(n).get("msgs").get("a").put(null),this.put("participants",this.participants),e.next=8,t.SEA.secret(_e.getKey().epub,_e.getKey());case 8:return r=e.sent,e.t0=H().get("chats").get(n).get("pub"),e.next=12,t.SEA.encrypt({uuid:this.uuid,myGroupSecret:this.getMyGroupSecret(),participants:this.participants},r);case 12:e.t1=e.sent,e.t0.put.call(e.t0,e.t1),this.participantsChanged(),e.next=27;break;case 17:a=this.getCurrentParticipants(),s=0;case 19:if(!(s<a.length)){e.next=27;break}return e.next=22,this.getOurSecretChannelId(a[s]);case 22:o=e.sent,H().get("chats").get(o).get("msgs").get("a").put(null);case 24:s++,e.next=19;break;case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.put=function(){var e=s(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.putGroup:this.putDirect).call(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.putGroup=function(){var e=s(i().mark((function e(n,r){var a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("msgs"!==n){e.next=2;break}throw new Error("Sorry, you can't overwrite the msgs field which is used for .send()");case 2:return e.next=4,t.SEA.encrypt(JSON.stringify(r),this.getMyGroupSecret());case 4:return a=e.sent,e.next=7,this.getMySecretUuid();case 7:s=e.sent,H().get("chats").get(s).get(n).put(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.putDirect=function(){var e=s(i().mark((function e(n,r){var a,s,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("msgs"!==n){e.next=2;break}throw new Error("Sorry, you can't overwrite the msgs field which is used for .send()");case 2:a=this.getCurrentParticipants(),s=0;case 4:if(!(s<a.length)){e.next=20;break}return e.t0=t.SEA,e.t1=JSON.stringify(r),e.next=9,this.getSecret(a[s]);case 9:return e.t2=e.sent,e.next=12,e.t0.encrypt.call(e.t0,e.t1,e.t2);case 12:return o=e.sent,e.next=15,this.getOurSecretChannelId(a[s]);case 15:u=e.sent,H().get("chats").get(u).get(n).put(o);case 17:s++,e.next=4;break;case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.on=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onGroup:this.onDirect).call(this,t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onDirect=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&"me"!==r&&r!==_e.getKey().pub||this.onMy(t,(function(e){return n(e,_e.getKey().pub)})),(!r||"me"!==r&&r!==_e.getKey().pub)&&this.onTheir(t,(function(e,t,r){return n(e,r)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onGroup=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&"me"!==r&&r!==_e.getKey().pub||this.onMyGroup(t,(function(e){return n(e,_e.getKey().pub)})),(!r||"me"!==r&&r!==_e.getKey().pub)&&this.onTheirGroup(t,(function(e,t,r){return n(e,r)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onMy=function(){var e=s(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onMyGroup:this.onMyDirect).call(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onMyDirect=function(){var e=s(i().mark((function e(n,r){var a,o,u,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=2;break}throw new Error("onMy callback must be a function, got "+typeof r);case 2:a=this.getCurrentParticipants(),o=i().mark((function e(o){var u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getOurSecretChannelId(a[o]);case 2:return u=e.sent,G().user().get("chats").get(u).get(n).on(function(){var e=s(i().mark((function e(s){var u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.SEA,e.t1=s,e.next=4,c.getSecret(a[o]);case 4:return e.t2=e.sent,e.next=7,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 7:(u=e.sent)&&r(void 0!==u.v?u.v:u,n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return","break");case 5:case"end":return e.stop()}}),e)})),u=0;case 5:if(!(u<a.length)){e.next=13;break}return e.delegateYield(o(u),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:u++,e.next=5;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onMyGroup=function(){var e=s(i().mark((function e(n,r){var a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof r){e.next=2;break}throw new Error("onMy callback must be a function, got "+typeof r);case 2:return e.next=4,this.getMySecretUuid();case 4:return a=e.sent,e.next=7,this.getMyGroupSecret();case 7:o=e.sent,G().user().get("chats").get(a).get(n).on(function(){var e=s(i().mark((function e(a){var s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.decrypt(a,o);case 2:(s=e.sent)&&r(void 0!==s.v?s.v:s,n,_e.getKey().pub);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.onTheir=function(){var e=s(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.uuid?this.onTheirGroup:this.onTheirDirect).call(this,t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n._onTheirDirectFromUser=function(){var e=s(i().mark((function e(n,r,a){var o,u=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasWritePermission(a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getTheirSecretChannelId(a);case 4:o=e.sent,G().user(a).get("chats").get(o).get(n).on(function(){var e=s(i().mark((function e(s){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.hasWritePermission(a)){e.next=2;break}return e.abrupt("return");case 2:return e.t0=t.SEA,e.t1=s,e.next=6,u.getSecret(a);case 6:return e.t2=e.sent,e.next=9,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 9:(o=e.sent)&&r(void 0!==o.v?o.v:o,n,a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.onTheirDirect=function(){var e=s(i().mark((function e(t,n,r){var a=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof n){e.next=2;break}throw new Error("onTheir callback must be a function, got "+typeof n);case 2:Object.prototype.hasOwnProperty.call(this.directSubscriptions,t)||(this.directSubscriptions[t]=[]),this.directSubscriptions[t].push({key:t,callback:n,from:r}),this.getCurrentParticipants().forEach(function(){var e=s(i().mark((function e(s){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||s===r){e.next=2;break}return e.abrupt("return");case 2:a._onTheirDirectFromUser(s,t,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.hasWritePermission=function(e){return!this.uuid||this.participants&&this.participants[e]&&this.participants[e].write},n._onTheirGroupFromUser=function(){var e=s(i().mark((function e(n,r,a,o){var u,c=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasWritePermission(n)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getTheirSecretUuid(n);case 4:u=e.sent,G().user(n).get("chats").get(u).get(r).on(function(){var e=s(i().mark((function e(s,u,l,p){var h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&(o.event=p),c.hasWritePermission(n)){e.next=3;break}return e.abrupt("return");case 3:return e.t0=t.SEA,e.t1=s,e.next=7,c.getTheirGroupSecret(n);case 7:return e.t2=e.sent,e.next=10,e.t0.decrypt.call(e.t0,e.t1,e.t2);case 10:(h=e.sent)&&a(void 0!==h.v?h.v:h,r,n);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),n.onTheirGroup=function(){var e=s(i().mark((function e(t,n,r){var a,o=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof n){e.next=2;break}throw new Error("onTheir callback must be a function, got "+typeof n);case 2:Object.prototype.hasOwnProperty.call(this.groupSubscriptions,t)||(this.groupSubscriptions[t]=[]),this.groupSubscriptions[t].push(a={key:t,callback:n,from:r}),this.getParticipants((function(e){Object.keys(e).forEach(function(){var u=s(i().mark((function s(u){return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r||u===r){i.next=2;break}return i.abrupt("return");case 2:if(e[u]&&e[u].write){i.next=4;break}return i.abrupt("return");case 4:o._onTheirGroupFromUser(u,t,n,a);case 5:case"end":return i.stop()}}),s)})));return function(e){return u.apply(this,arguments)}}())}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),n.setTyping=function(e,t){var n=this;void 0===t&&(t=5),t*=1e3,this.put("typing",(e=void 0===e||e)?(new Date).toISOString():new Date(0).toISOString()),clearTimeout(this.setTypingTimeout),this.setTypingTimeout=setTimeout((function(){return n.put("typing",!1)}),t)},n.getTyping=function(e,t){var n=this;void 0===t&&(t=5),t*=1e3,this.onTheir("typing",(function(r,i,a){if(e){var s=r&&new Date-new Date(r)<=t;e(s,a),n.getTypingTimeouts=n.getTypingTimeouts||{},clearTimeout(n.getTypingTimeouts[a]),s&&(n.getTypingTimeouts[a]=setTimeout((function(){return e(!1,a)}),t))}}))},e.addChatButton=function(t){if(void 0===t&&(t={}),!(t=Object.assign({label:"Chat"},t)).channelOptions)throw new Error("addChatButton missing options.channelOptions param");var n,r;x.injectCss();var i=x.createElement("div","iris-chat-open-button",document.body);i.setAttribute("id","iris-chat-open-button"),i.innerHTML='<svg style="margin-right:7px;margin-bottom: -0.2em" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 510 510" xml:space="preserve"><path fill="currentColor" d="M459,0H51C22.95,0,0,22.95,0,51v459l102-102h357c28.05,0,51-22.95,51-51V51C510,22.95,487.05,0,459,0z M102,178.5h306v51 H102V178.5z M306,306H102v-51h204V306z M408,153H102v-51h306V153z"></path></svg> '+t.label,i.addEventListener("click",(function(){i.setAttribute("style","display: none"),n?r.setAttribute("style",""):(n=new e(t.channelOptions),r=n.getChatBox(),document.body.appendChild(r))}))},n.getSimpleLink=function(e){return void 0===e&&(e="https://iris.to/"),this.uuid?e+"?channelId="+this.uuid+"&inviter="+_e.getKey().pub:e+"?chatWith="+this.getCurrentParticipants()[0]},n.getChatLinks=function(){var n=s(i().mark((function n(r){var a,o,u,c,l,p,h=this;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===r&&(r={}),o=(a=r).callback,c=a.subscribe,u=(u=a.urlRoot)||"https://iris.to/",this.uuid){n.next=5;break}throw new Error("Only group channels may have chat links");case 5:l=[],p={},this.on("chatLinks",(function(n,r){n&&"object"==typeof n&&Object.keys(n).forEach((function(a){var f=n[a];if(null===f)return p[a]&&p[a].off(),delete p[a],void(o&&o({id:a,url:null}));if(-1===l.indexOf(a)){var d=[];l.push(a);var g=e.formatChatLink({urlRoot:u,inviter:r,channelId:h.uuid,sharedSecret:f.sharedSecret,linkId:a});o&&o({url:g,id:a}),c&&G().user(f.sharedKey.pub).get("chatRequests").map(function(){var e=s(i().mark((function e(n,r,s,o){var u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&"string"==typeof n&&!(n.length<10)){e.next=2;break}return e.abrupt("return");case 2:if(p[a]=o,u=JSON.stringify(n),-1!==d.indexOf(u)){e.next=10;break}return d.push(u),e.next=8,t.SEA.decrypt(n,f.sharedSecret);case 8:h.addParticipant(e.sent,void 0,void 0,!0);case 10:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}())}}))}));case 8:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),n.createChatLink=function(){var n=s(i().mark((function n(r){var a,s,o,u,c,l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),n.next=3,t.SEA.pair();case 3:return a=n.sent,s=JSON.stringify(a),n.next=7,t.SEA.secret(a.epub,a);case 7:return o=n.sent,n.next=10,t.SEA.encrypt(s,o);case 10:return u=n.sent,n.next=13,t.SEA.secret(_e.getKey().epub,_e.getKey());case 13:return c=n.sent,n.next=16,t.SEA.encrypt(s,c);case 16:return l=n.sent,n.next=19,x.getHash(u);case 19:return p=(p=n.sent).slice(0,12),G(a).get("chatRequests").put({a:1}),this.chatLinks[p]={sharedKey:a,sharedSecret:o},this.put("chatLinks",this.chatLinks),H().get("chatLinks").get(p).put({encryptedSharedKey:u,ownerEncryptedSharedKey:l}),n.abrupt("return",e.formatChatLink({urlRoot:r,channelId:this.uuid,inviter:_e.getKey().pub,sharedSecret:o,linkId:p}));case 26:case"end":return n.stop()}}),n,this)})));return function(e){return n.apply(this,arguments)}}(),n.getChatBox=function(){var t=this;x.injectCss();var n=!1,r=x.createElement("div","iris-chat-box"),i=x.createElement("div","iris-chat-header",r),a=x.createElement("span","iris-chat-minimize",i);a.innerText="—",a.addEventListener("click",(function(e){e.stopPropagation(),r.setAttribute("class","iris-chat-box minimized"),n=!0}));var s=x.createElement("div","iris-chat-header-text",i),o=x.createElement("span","iris-online-indicator",s);o.innerHTML="&#x25cf;";var u=x.createElement("span",void 0,s),c=x.createElement("span","iris-chat-close",i);c.innerHTML="&#215;",c.addEventListener("click",(function(){r.setAttribute("style","display: none");var e=document.getElementById("iris-chat-open-button");e&&e.setAttribute("style","")})),i.addEventListener("click",(function(){n&&(r.setAttribute("class","iris-chat-box"),n=!1)}));var l=x.createElement("div","iris-chat-messages",r),p=x.createElement("div","iris-typing-indicator",r);p.innerText="typing...",this.getTyping((function(e){p.setAttribute("class","iris-typing-indicator"+(e?" yes":""))}));var h=x.createElement("div","iris-chat-input-wrapper",r),f=x.createElement("textarea",void 0,h);if(f.setAttribute("rows","1"),f.setAttribute("placeholder","Type a message"),x.isMobile){var d=x.createElement("button",void 0,h);d.innerHTML='\n        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 486.736 486.736" style="enable-background:new 0 0 486.736 486.736;" xml:space="preserve" width="100px" height="100px" fill="#000000" stroke="#000000" stroke-width="0"><path fill="currentColor" d="M481.883,61.238l-474.3,171.4c-8.8,3.2-10.3,15-2.6,20.2l70.9,48.4l321.8-169.7l-272.4,203.4v82.4c0,5.6,6.3,9,11,5.9 l60-39.8l59.1,40.3c5.4,3.7,12.8,2.1,16.3-3.5l214.5-353.7C487.983,63.638,485.083,60.038,481.883,61.238z"></path></svg>\n      ',d.addEventListener("click",(function(){t.send(f.value),f.value="",t.setTyping(!1)}))}var g=this.getCurrentParticipants();if(g.length){var m=g[0];G().user(m).get("profile").get("name").on((function(e){return u.innerText=e})),e.getActivity(G(),m,(function(e){o.setAttribute("class","iris-online-indicator"+(e.isActive?" yes":"")),l.querySelectorAll(".iris-chat-message:not(.delivered)").forEach((function(t){if(t.getAttribute("data-time")<=e.lastActive){var n=t.getAttribute("class");t.setAttribute("class",n+" delivered")}}))}))}return this.getTheirMsgsLastSeenTime((function(e){l.querySelectorAll(".iris-seen:not(.yes)").forEach((function(t){var n=t.parentElement.parentElement.parentElement;if(n.getAttribute("data-time")<=e){var r=n.getAttribute("class");-1===r.indexOf("delivered")&&n.setAttribute("class",r+" delivered"),t.setAttribute("class","iris-seen yes")}}))})),this.getMessages((function(e,n){var r=x.createElement("div","iris-msg-content");r.innerText=e.text;var i=x.createElement("div","time",r);i.innerText=x.formatTime(new Date(e.time)),n.selfAuthored&&(x.createElement("span",t.theirMsgsLastSeenTime>=e.time?"iris-seen yes":"iris-seen",i).innerHTML=' <svg version="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59 42"><polygon fill="currentColor" points="40.6,12.1 17,35.7 7.4,26.1 4.6,29 17,41.3 43.4,14.9"></polygon><polygon class="iris-delivered-checkmark" fill="currentColor" points="55.6,12.1 32,35.7 29.4,33.1 26.6,36 32,41.3 58.4,14.9"></polygon></svg>'),r.innerHTML=r.innerHTML.replace(/\n/g,"<br>\n");var a=x.createElement("div",(n.selfAuthored?"our":"their")+" iris-chat-message");a.appendChild(r),a.setAttribute("data-time",e.time);for(var s=l.children.length;s>=0;s--)if(0===s)l.insertBefore(a,l.firstChild);else{var o=l.children[s-1].getAttribute("data-time");if(o&&o<e.time){l.children[s-1].insertAdjacentElement("afterend",a);break}}l.scrollTop=l.scrollHeight})),f.addEventListener("keyup",(function(e){if(t.setMyMsgsLastSeenTime(),13===e.keyCode){e.preventDefault();var n=f.value,r=x.getCaret(f);e.shiftKey?f.value=n.substring(0,r-1)+"\n"+n.substring(r,n.length):(f.value=n.substring(0,r-1)+n.substring(r,n.length),t.send(f.value),f.value="",t.setTyping(!1))}else t.setTyping(!!f.value.length)})),r},e.setActivity=function(e){if(G().irisActivityStatus!==e){G().irisActivityStatus=e,clearTimeout(G().setActivityTimeout);var n=function(){G().user().get("activity").put({status:e,time:new Date(t.state()).toISOString()})};n(),e&&function e(){n(),G().setActivityTimeout=setTimeout(e,3e3)}()}},e.getActivity=function(e,n){var r;G().user(e).get("activity").on((function(e){if(e&&e.time&&e.status){clearTimeout(r);var i=new Date(t.state()),a=new Date(e.time),s=a>new Date(i.getTime()-1e4)&&a<new Date(i.getTime()+3e4);n({isActive:s,lastActive:e.time,status:e.status}),s&&(r=setTimeout((function(){return n({isOnline:!1,lastActive:e.time})}),1e4))}}))},e.formatChatLink=function(e){var t=e.urlRoot,n=e.chatWith,r=e.channelId,i=e.inviter,a=e.sharedSecret,s=e.linkId,o=encodeURIComponent;return r&&i?t+"?channelId="+o(r)+"&inviter="+o(i)+"&s="+o(a)+"&k="+o(s):t+"?chatWith="+o(n)+"&s="+o(a)+"&k="+o(s)},e.createChatLink=function(){var n=s(i().mark((function n(r){var a,s,o,u,c,l,p,h,f;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),a=G().user(),s=_e.getKey(),n.next=5,t.SEA.pair();case 5:return o=n.sent,u=JSON.stringify(o),n.next=9,t.SEA.secret(o.epub,o);case 9:return c=n.sent,n.next=12,t.SEA.encrypt(u,c);case 12:return l=n.sent,n.next=15,t.SEA.secret(s.epub,s);case 15:return p=n.sent,n.next=18,t.SEA.encrypt(u,p);case 18:return h=n.sent,n.next=21,x.getHash(l);case 21:return f=(f=n.sent).slice(0,12),G(o).get("chatRequests").put({a:1}).get("chatRequests").put({a:1}),a.get("chatLinks").get(f).put({encryptedSharedKey:l,ownerEncryptedSharedKey:h}),n.abrupt("return",e.formatChatLink({urlRoot:r,chatWith:s.pub,sharedSecret:c,linkId:f}));case 26:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e.getMyChatLinks=function(){var n=s(i().mark((function n(r,a,o){var u,c,l,p;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===r&&(r="https://iris.to/"),void 0===o&&(o=!1),u=_e.getKey(),c=G().user(),n.next=6,t.SEA.secret(u.epub,u);case 6:l=n.sent,p=[],c.get("chatLinks").map((function(n,h){if(n&&-1===p.indexOf(h)){var f=[];c.get("chatLinks").get(h).get("ownerEncryptedSharedKey").on(function(){var n=s(i().mark((function n(c){var d,g,m;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c&&-1===p.indexOf(h)){n.next=2;break}return n.abrupt("return");case 2:return p.push(h),n.next=5,t.SEA.decrypt(c,l);case 5:return d=n.sent,n.next=8,t.SEA.secret(d.epub,d);case 8:m=e.formatChatLink({urlRoot:r,chatWith:u.pub,sharedSecret:g=n.sent,linkId:h}),a&&a({url:m,id:h}),o&&G().user(d.pub).get("chatRequests").map(function(){var n=s(i().mark((function n(r,a){var s;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return");case 2:if(s=JSON.stringify(r),-1!==f.indexOf(s)){n.next=10;break}return f.push(s),n.next=7,t.SEA.decrypt(r,g);case 7:new e({key:u,participants:n.sent}).save();case 10:G(d).get("chatRequests").get(a).put(null);case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}());case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}));case 9:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),n.removeGroupChatLink=function(e){this.chatLinks[e]=null,this.put("chatLinks",this.chatLinks),G().user().get("chatLinks").get(e).put(null)},e.removePrivateChatLink=function(e,t){G().user().auth(e),G().user().get("chatLinks").get(t).put(null)},e.deleteChannel=function(){var t=s(i().mark((function t(n,r){var a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return G().user().auth(n),t.next=3,e.getOurSecretChannelId(r,n);case 3:a=t.sent,G().user().get("channels").get(a).put(null),G().user().get("channels").get(a).off();case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.deleteGroup=function(){var e=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.secret(n.epub,n);case 2:return a=e.sent,e.next=5,x.getHash(a);case 5:return s=e.sent,e.next=8,x.getHash(s+r);case 8:o=e.sent,G().user().auth(n),G().user().get("channels").get(o).put(null),G().user().get("channels").get(o).off();case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e}(),B=new Map;function Q(e,t){void 0===e&&(e=_e.getKey());var n=B.get(e);return n||(n=new J({participants:e,chatLink:t}),B.set(e,n)),n}function V(){return F||(F=new U("local")),F}var $={};function Y(){return $||($={},V().get("block").map((function(e,t){e!==$[t]&&(e?($[t]=e,V().get("groups").map((function(e,n){V().get("groups").get(n).get(t).put(!1)}))):delete $[t])}))),$}var Z=0,X=new Map,ee=new Map;function te(e){return void 0===e&&(e="everyone"),{get:function(t,n){var r=V().get("groups").get(e),i={};requestAnimationFrame((function(){r.map((function(e,r){if(!Y()[r]&&(!i[r]||i[r]!==e)&&(i[r]=e,e)){var a=H(r);t&&"/"!==t&&(a=t.split("/").reduce((function(e,t){return e.get(decodeURIComponent(t))}),a)),n(a,r)}}))}))},_cached_map:function(e,t,n,r,i){if(e)for(var a,s=d(e.values());!(a=s()).done;){var o=a.value;i(o.value,o.key,0,r,o.from)}else{var u=new Map;X.set(t,u),this.get(n,(function(e,n){return e.map((function(e,i,a){u.set(i,{value:e,key:i,from:n});for(var s,o=d(ee.get(t).values());!(s=o()).done;)(0,s.value)(e,i,a,r,n)}))}))}},_cached_on:function(e,t,n,r,i){if(e)for(var a,s=d(e.values());!(a=s()).done;){var o=a.value;i(o.value,o.key,0,r,o.from)}else{var u=new Map;X.set(t,u),this.get(n,(function(e,n){return e.on((function(e,i,a){u.set(n,{value:e,key:i,from:n});for(var s,o=d(ee.get(t).values());!(s=o()).done;)(0,s.value)(e,i,a,r,n)}))}))}},_cached_count:function(e,t,n,r,i){if(e)i(e.size,n.split("/").pop(),null,r);else{var a=new Map;X.set(t,a),this.get(n,(function(e,n){return e.on((function(e,i){e?a.set(n,!0):a.delete(n);for(var s,o=a.size,u=d(ee.get(t).values());!(s=u()).done;)(0,s.value)(o,i,null,r,n)}))}))}},_cached_fn:function(t,n,r){var i=t+":"+e+":"+n,a=Z++;ee.has(i)?ee.get(i).set(a,r):ee.set(i,new Map([[a,r]]));var s={off:function(){var e=ee.get(i);e&&e.delete(a)}},o=X.get(i);switch(t){case"map":this._cached_map(o,i,n,s,r);break;case"on":this._cached_on(o,i,n,s,r);break;case"count":this._cached_count(o,i,n,s,r)}},map:function(e,t){this._cached_fn("map",e,t)},on:function(e,t){this._cached_fn("on",e,t)},count:function(e,t){this._cached_fn("count",e,t)}}}var ne,re=0,ie=0,ae={};function se(){return window.Notification&&"granted"===Notification.permission}var oe="BMqSvZArOIdn7vGkYplSpkZ70-Qt8nhYbey26WVa3LF3SwzblSzm3n3HHycpNkAKVq7MCkrzFuTFs_en7Y_J2MI";function ue(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}function ce(e){return le.apply(this,arguments)}function le(){return(le=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ue(oe)});case 3:fe(e.sent),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("web push subscription error",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function pe(){return(pe=s(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("subscribing to web push",navigator.serviceWorker),se()&&navigator.serviceWorker){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,navigator.serviceWorker.ready;case 5:return e.next=7,navigator.serviceWorker.getRegistration();case 7:return(t=e.sent).active.postMessage({key:_e.getKey()}),e.next=11,t.pushManager.getSubscription();case 11:(n=e.sent)?fe(n):ce(t);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=g.debounce((function(){var e=Object.values(ae);_e.channelIds.forEach((function(t){Q(t).put("webPushSubscriptions",e)}))}),5e3);function fe(e,t){return de.apply(this,arguments)}function de(){return(de=s(i().mark((function e(n,r){var a,s,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!0),a=_e.getKey(),e.next=4,t.SEA.secret(a.epub,a);case 4:return s=e.sent,e.next=7,t.SEA.encrypt(n,s);case 7:return o=e.sent,e.next=10,x.getHash(JSON.stringify(n));case 10:u=e.sent,console.log("hash",u),r&&G().user().get("webPushSubscriptions").get(u).put(o),ae[u]=n,he();case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(){return(ge=s(i().mark((function e(){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_e.getKey(),e.next=3,t.SEA.secret(n.epub,n);case 3:r=e.sent,G().user().get("webPushSubscriptions").map(function(){var e=s(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.SEA.decrypt(n,r);case 4:fe(e.sent,!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){return new Promise((function(t){G().user(e).get("epub").on(function(){var e=s(i().mark((function e(n,r,a,s){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&(s.off(),t(n));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}())}))}function ve(e){return ye.apply(this,arguments)}function ye(){return(ye=s(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G().user(t.from).get("profile").once();case 2:return r=(n=e.sent)&&n.name||"someone",e.abrupt("return","like"===(a=t.event||t.action)?r+" liked your post":"reply"===a?r+" replied to your post":"mention"===a?r+" mentioned you in their post":"follow"===a?r+" started following you":r+" sent you a notification: "+a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){e?(ie+=e,ie=Math.max(ie,0)):(ie=0,G().user().get("notificationsSeenTime").put((new Date).toISOString())),V().get("unseenNotificationCount").put(ie)}function we(){return(we=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&r){e.next=2;break}return e.abrupt("return");case 2:return"object"==typeof r&&(r.time=(new Date).toISOString()),e.next=5,me(n);case 5:return a=e.sent,e.next=8,t.SEA.secret(a,_e.getKey());case 8:return s=e.sent,e.next=11,t.SEA.encrypt(r,s);case 11:o=e.sent,G().user().get("notifications").get(n).put(o);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=s(i().mark((function e(n,r){var a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("sending web push notification to",n,r),a=Q(n),s=_e.getKey(),n!==s.pub&&a.activity&&a.activity.isActive||!a.webPushSubscriptions){e.next=9;break}return e.delegateYield(i().mark((function e(){var n,o,u,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],o=Object.keys(a.webPushSubscriptions),u=i().mark((function e(u){var c,l,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=o[u],e.next=3,a.getSecret(c);case 3:return l=e.sent,e.next=6,t.SEA.encrypt(r.title,l);case 6:return e.t0=e.sent,e.next=9,t.SEA.encrypt(r.body,l);case 9:e.t1=e.sent,e.t2={pub:s.pub,epub:s.epub},p={title:e.t0,body:e.t1,from:e.t2},a.webPushSubscriptions[c].forEach((function(e){e&&e.endpoint&&n.push({subscription:e,payload:p})}));case 13:case"end":return e.stop()}}),e)})),c=0;case 4:if(!(c<o.length)){e.next=9;break}return e.delegateYield(u(c),"t0",6);case 6:c++,e.next=4;break;case 9:if(0!==n.length){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:fetch("https://iris-notifications.herokuapp.com/notify",{method:"POST",body:JSON.stringify({subscriptions:n}),headers:{"content-type":"application/json"}}).catch((function(){}));case 12:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:if("object"!=typeof(o=e.t0)){e.next=9;break}return e.abrupt("return",o.v);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ke,Se,Ae,Ee,Te,Me,Oe,je,Ce,Ie,Le={init:function(){ne=new Date,re=0},notifyMsg:function(e,t,n,r){function i(){if(e.timeObj<ne)return!1;if(t.selfAuthored)return!1;if("visible"===document.visibilityState)return!1;var r=Q(n);return"nothing"!==r.notificationSetting&&!("mentions"===r.notificationSetting&&!e.text.includes(_e.getMyName()))}if(i(),se()&&i()){var a,s,o=Q(n);o.uuid?(s=o.participantProfiles[t.from].name,a=name+": "+e.text):(s="Message",a=e.text),a=x.truncateString(a,50),new Notification(s,{icon:"/assets/img/icon128.png",body:a,silent:!0}).onclick=function(){be(-1),r&&r(),window.focus()}}},getNotificationText:ve,sendWebPushNotification:function(e,t){return xe.apply(this,arguments)},changeUnseenNotificationCount:be,subscribeToIrisNotifications:function(e){var n,r;G().user().get("notificationsSeenTime").on((function(e){n=e,console.log(e)})),G().user().get("notificationsShownTime").on((function(e){return r=e}));var a=g.debounce((function(){G().user().get("notificationsShownTime").put((new Date).toISOString())}),1e3),o=new Set;te().on("notifications/"+_e.getPubKey(),function(){var u=s(i().mark((function s(u,c,l,p,h){var f,d,g,m,v;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(f=h.slice(0,30)+u.slice(0,30),!o.has(f)){i.next=3;break}return i.abrupt("return");case 3:return o.add(f),i.next=6,me(h);case 6:return d=i.sent,i.next=9,t.SEA.secret(d,_e.getKey());case 9:return g=i.sent,i.next=12,t.SEA.decrypt(u,g);case 12:if((m=i.sent)&&"object"==typeof m){i.next=15;break}return i.abrupt("return");case 15:if(a(),m.from=h,V().get("notifications").get(m.time).put(m),(!n||n<m.time)&&be(1),r&&!(r<m.time)){i.next=26;break}return console.log("was new!"),i.next=23,ve(m);case 23:v=i.sent,new Notification(v,{icon:"/assets/img/icon128.png",body:v,silent:!0}).onclick=function(){e&&e(m.target?"/post/"+m.target:"/profile/"+m.from),be(-1),window.focus()};case 26:case"end":return i.stop()}}),s)})));return function(e,t,n,r,i){return u.apply(this,arguments)}}())},sendIrisNotification:function(e,t){return we.apply(this,arguments)},changeChatUnseenCount:function(e,t){var n=Q(e);if(n){var r=V().get("channels").get(e);t?(re+=t,n.unseen+=t):(re-=n.unseen||0,n.unseen=0),r.get("unseen").put(n.unseen),re=re>=0?re:0,V().get("unseenMsgsTotal").put(re)}},webPushSubscriptions:ae,subscribeToWebPush:function(){return pe.apply(this,arguments)},getWebPushSubscriptions:function(){return ge.apply(this,arguments)},removeSubscription:function(e){delete ae[e],G().user().get("webPushSubscriptions").get(e).put(null),he()}},Pe=x.isElectron?new U("electron").get("state"):null,De={},ze=new Map,Ke="hyECQHwSo7fgr2MVfPyakvayPeixxsaAWVtZ-vbaiSc.TXIp8MnCtrnW6n2MrYquWPcc-DTmZzMBmc2yaGv9gIU",Ne={electron:{openAtLogin:!0,minimizeOnClose:!0},local:{enableWebtorrent:!x.isMobile,enablePublicPeerDiscovery:!0,autoplayWebtorrent:!0,maxConnectedPeers:x.isElectron?2:1}},_e={init:function(e){var t=this;if(void 0===e&&(e={}),!Ce){Ce=!0;var n=localStorage.getItem("chatKeyPair");n?this.login(JSON.parse(n)):!1!==e.autologin?this.loginAsNewUser(e):this.clearIndexedDB(),setTimeout((function(){V().get("block").map((function(){t.updateSearchIndex()})),t.updateSearchIndex()})),setInterval((function(){if(t.taskQueue.length){var e=t.taskQueue.shift();e&&e()}}),10)}},DEFAULT_SETTINGS:Ne,DEFAULT_FOLLOW:Ke,taskQueue:[],updateSearchIndex:g.throttle((function(){var e=Object.values(g.omit(De,Object.keys(Y())));je=new r(e,{keys:["name"],includeScore:!0,includeMatches:!0,threshold:.3}),V().get("searchIndexUpdated").put(!0)}),2e3,{leading:!0}),saveSearchResult:g.throttle((function(e){V().get("contacts").get(e).put({followDistance:De[e].followDistance,followerCount:De[e].followers.size})}),1e3,{leading:!0}),addFollow:function(e,t,n,r){De[t]?(De[t].followDistance>n&&(De[t].followDistance=n),r&&De[t].followers.add(r)):(De[t]={key:t,followDistance:n,followers:new Set(r&&[r])},this.taskQueue.push((function(){H(t).get("profile").get("name").on((function(n){De[t].name=n,V().get("contacts").get(t).get("name").put(n),e&&e(t,De[t])}))}))),this.saveSearchResult(t),e&&e(t,De[t]),this.updateSearchIndex(),this.updateNoFollows(),this.updateNoFollowers()},removeFollow:function(e,t,n){1===t&&(V().get("contacts").get(e).put(!1),V().get("groups").get("follows").get(e).put(!1),De[e]&&(De[e].followers.delete(n),this.updateNoFollows(),this.updateNoFollowers())),De[e]&&0===De[e].followers.size&&(delete De[e],V().get("contacts").get(e).put(!1),V().get("groups").get("everyone").get(e).put(!1))},getExtendedFollows:function(e,t,n,r){var i=this;void 0===t&&(t=ke.pub),void 0===n&&(n=3),void 0===r&&(r=1);var a=ze.get(t);if(!(a&&a<=r))return ze.set(t,r),this.addFollow(e,t,r-1),H(t).get("follow").map((function(a,s){a?(i.addFollow(e,s,r,t),r<n&&i.taskQueue.push((function(){return i.getExtendedFollows(e,s,n,r+1)}))):i.removeFollow(s,r,t)})),De},updateNoFollows:g.throttle((function(){var e=Object.keys(De).length<=1;e!==Me&&(Me=e,V().get("noFollows").put(Me))}),1e3,{leading:!0}),updateNoFollowers:g.throttle((function(){var e=!(De[ke.pub]&&De[ke.pub].followers.size>0);e!==Oe&&(Oe=e,V().get("noFollowers").put(Oe))}),1e3,{leading:!0}),getSearchIndex:function(){return je},setOurOnlineStatus:function(){var e=window.location.hash;J.setActivity(Te="active");var t=g.debounce((function(){var t=Q(e&&e.replace("#/profile/","").replace("#/chat/",""));t&&!Te&&t.setMyMsgsLastSeenTime(),J.setActivity(Te="active"),clearTimeout(Ee),Ee=setTimeout((function(){return J.setActivity(Te="online")}),3e4)}),1e3);document.addEventListener("touchmove",t),document.addEventListener("mousemove",t),document.addEventListener("keypress",t),document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState){J.setActivity(Te="active");var t=location.pathname.slice(1).replace("chat/",""),n=e&&Q(t);n&&(n.setMyMsgsLastSeenTime(),Le.changeChatUnseenCount(t,0))}else J.setActivity(Te="online")})),t(),window.addEventListener("beforeunload",(function(){J.setActivity(Te=null)}))},updateGroups:function(){var e=this;this.getExtendedFollows((function(t,n){n.followDistance<=1&&V().get("groups").get("follows").get(t).put(!0),V().get("groups").get("everyone").get(t).put(!0),t===e.getPubKey()&&e.updateNoFollowers()}))},login:function(e){var t=this,n=!!ke;ke=e,localStorage.setItem("chatKeyPair",JSON.stringify(e)),H().auth(ke),H().put({epub:ke.epub}),Le.subscribeToWebPush(),Le.getWebPushSubscriptions(),J.getMyChatLinks(void 0,(function(e){V().get("chatLinks").get(e.id).put(e.url),Ae=e.url})),this.setOurOnlineStatus(),J.getChannels((function(e){return t.addChannel(e)})),H().get("profile").get("name").on((function(e){e&&"string"==typeof e&&(Se=e)})),Le.init(),V().get("loggedIn").put(!0),V().get("settings").once().then((function(e){e?void 0!==e.enableWebtorrent&&void 0!==e.autoplayWebtorrent||(V().get("settings").get("enableWebtorrent").put(Ne.local.enableWebtorrent),V().get("settings").get("autoplayWebtorrent").put(Ne.local.autoplayWebtorrent)):V().get("settings").put(Ne.local)})),H().get("block").map((function(e,t){V().get("block").get(t).put(e),e&&delete De[t]})),this.updateGroups(),n&&location.reload(),Pe&&(Pe.get("settings").on((function(e){V().get("settings").get("electron").put(e)})),Pe.get("user").put(ke.pub)),V().get("filters").get("group").once().then((function(e){e||V().get("filters").get("group").put("follows")}))},loginAsNewUser:function(e){var n=this;void 0===e&&(e={});var r=e.name||x.generateName();return console.log("loginAsNewUser name",r),t.SEA.pair().then((function(t){n.login(t),H().get("profile").put({a:null}),H().get("profile").get("name").put(r),V().get("filters").put({a:null}),V().get("filters").get("group").put("follows"),J.createChatLink().then((function(e){return Ae=e})),setTimeout((function(){!1!==e.autofollow&&(console.log("autofollowing",Ke),H().get("follow").get(Ke).put(!0))}),1e3)}))},logOut:function(){var e=this;return s(i().mark((function t(){var n,r,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pe&&Pe.get("user").put(null),!navigator.serviceWorker){t.next=16;break}return t.next=4,navigator.serviceWorker.getRegistration();case 4:if(!(n=t.sent)||!n.pushManager){t.next=16;break}return null==(r=n.active)||r.postMessage({key:null}),t.next=9,n.pushManager.getSubscription();case 9:if(!(a=t.sent)){t.next=16;break}return t.next=13,x.getHash(JSON.stringify(a));case 13:Le.removeSubscription(t.sent),a.unsubscribe&&a.unsubscribe();case 16:e.clearIndexedDB(),localStorage.clear(),window.location.hash="",window.location.href="/",location.reload();case 21:case"end":return t.stop()}}),t)})))()},clearIndexedDB:function(){return new Promise((function(e){var t=window.indexedDB.deleteDatabase("local()"),n=window.indexedDB.deleteDatabase("radata"),r=!1,i=!1,a=function(){r&&i&&e(void 0)};t.onerror=n.onerror=function(e){return console.error(e)},t.onsuccess=function(){r=!0,a()},n.onsuccess=function(){i=!0,a()}}))},getMyChatLink:function(){return Ae||x.getProfileLink(ke.pub)},getKey:function(){return ke},getPubKey:function(){return ke&&ke.pub},getMyName:function(){return Se},myPeerUrl:function(e){return"http://"+e+":8767/gun"},shareMyPeerUrl:function(e){var t=this;return s(i().mark((function n(){var r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,V().get("settings").get("electron").get("publicIp").once();case 2:(r=n.sent)&&e.put&&e.put("my_peer",t.myPeerUrl(r));case 4:case"end":return n.stop()}}),n)})))()},newChannel:function(e,t){if(e&&!this.channelIds.has(e)){var n=Q(e,t);return this.addChannel(n),n}},addChannel:function(e){var t=this;this.taskQueue.push((function(){var n=e.getId();if(!t.channelIds.has(n)){t.channelIds.add(n);var r=V().get("channels").get(n);if(r.get("latestTime").on((function(t){t&&(!e.latestTime||t>e.latestTime)&&(e.latestTime=t)})),r.get("theirMsgsLastSeenTime").on((function(t){if(t){var n=new Date(t);(!e.theirMsgsLastSeenDate||e.theirMsgsLastSeenDate<n)&&(e.theirMsgsLastSeenDate=n)}})),e.getLatestMsg&&e.getLatestMsg((function(e,r){t.processMessage(n,e,r)})),Le.changeChatUnseenCount(n,0),e.notificationSetting="all",e.onMy("notificationSetting",(function(t){e.notificationSetting=t})),e.theirMsgsLastSeenTime="",e.getTheirMsgsLastSeenTime((function(t){e&&t&&t>=e.theirMsgsLastSeenTime&&(e.theirMsgsLastSeenTime=t,r.get("theirMsgsLastSeenTime").put(t))})),e.getMyMsgsLastSeenTime((function(t){e.myLastSeenTime=new Date(t),e.latest&&e.myLastSeenTime>=e.latest.time&&Le.changeChatUnseenCount(n,0)})),e.isTyping=!1,e.getTyping((function(t){e.isTyping=t,V().get("channels").get(n).get("isTyping").put(t)})),e.online={},J.getActivity(n,(function(t){e&&(r.put({theirLastActiveTime:t&&t.lastActive,activity:t&&t.isActive&&t.status}),e.activity=t)})),e.uuid){var i=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e.participantProfiles={},e.on("name",(function(t){e.name=t,De[e.uuid]={name:t,uuid:e.uuid},V().get("channels").get(e.uuid).get("name").put(t)})),e.on("photo",(function(t){De[e.uuid]=De[e.uuid]||{},De[e.uuid].photo=t,V().get("channels").get(e.uuid).get("photo").put(t)})),e.on("about",(function(t){return V().get("channels").get(e.uuid).get("about").put(t)})),e.getParticipants((function(t){if(delete t.undefined,"object"==typeof t){var n=Object.keys(t);n.forEach((function(r,a){var s=360/Math.max(n.length,2)*a;e.participantProfiles[r]={permissions:t[r],color:"hsl("+s+", 98%, "+(i?80:33)+"%)"},H(r).get("profile").get("name").on((function(t){e.participantProfiles[r].name=t}))}))}V().get("channels").get(e.uuid).get("participants").put(t)})),e.inviteLinks={},e.getChatLinks({callback:function(t){var n=t.url,r=t.id;console.log("got chat link",r,n),e.inviteLinks[r]=n,V().get("inviteLinksChanged").put(!0)}})}else H(n).get("profile").get("name").on((function(e){return V().get("channels").get(n).get("name").put(e)}));if(e.put){e.onTheir("webPushSubscriptions",(function(t,r,i){Array.isArray(t)&&(e.webPushSubscriptions=e.webPushSubscriptions||{},e.webPushSubscriptions[i||n]=t)}));var a=Object.values(Le.webPushSubscriptions);setTimeout((function(){return e.put("webPushSubscriptions",a)}),5e3),t.shareMyPeerUrl(e)}e.onTheir("call",(function(e){V().get("call").put({pub:n,call:e})})),V().get("channels").get(n).put({enabled:!0})}}))},processMessage:function(e,t,n,r){var i=Q(e);i.messageIds=i.messageIds||{},i.messageIds[t.time+n.from]||(i.messageIds[t.time+n.from]=!0,n&&(t=Object.assign(t,n)),t.invite?this.newChannel(t.invite.group,"https://iris.to/?channelId="+t.invite.group+"&inviter="+e):(t.selfAuthored=n.selfAuthored,V().get("channels").get(e).get("msgs").get(t.time+(t.from&&t.from.slice(0,10))).put(JSON.stringify(t)),t.timeObj=new Date(t.time),!n.selfAuthored&&t.timeObj>i.myLastSeenTime&&(window.location.hash!=="#/chat/"+e||"visible"!==document.visibilityState?Le.changeChatUnseenCount(e,1):"active"===Te&&i.setMyMsgsLastSeenTime()),!n.selfAuthored&&t.time>i.theirMsgsLastSeenTime&&V().get("channels").get(e).get("theirMsgsLastSeenTime").put(t.time),(!i.latestTime||t.time>i.latestTime)&&V().get("channels").get(e).put({latestTime:t.time,latest:{time:t.time,text:t.text,selfAuthored:n.selfAuthored}}),Le.notifyMsg(t,n,e,r)))},subscribeToMsgs:function(e){var t=this,n=Q(e);n.subscribed||(n.subscribed=!0,n.getMessages((function(n,r){t.processMessage(e,n,r)})))},channelIds:new Set},Ue={get:function(e,t){return new Promise((function(n,r){e||r("No hash provided"),"string"!=typeof e&&r("Hash must be a string"),G().get("#").get(e).on((function(e,r,i,a){e&&(a.off(),t&&t(e),n(e))}))}))},put:function(e){return s(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.getHash(e);case 2:return n=t.sent,G().get("#").get(n).put(e),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()}},Ge=function(){function e(){}return e.getActiveKey=function(){var t=s(i().mark((function t(n,r,a){var s,o,u,c,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n="."),void 0===r&&(r="iris.key"),!Ie){t.next=4;break}return t.abrupt("return",Ie);case 4:if(!a){t.next=21;break}if(!a.existsSync(s=n+"/"+r)){t.next=11;break}o=a.readFileSync(s,"utf8"),Ie=e.fromString(o),t.next=17;break;case 11:return t.next=13,e.generate();case 13:u=t.sent,a.writeFileSync(s,e.toString(Ie=Ie||u)),a.chmodSync(s,400);case 17:if(Ie){t.next=19;break}throw new Error("loading default key failed - check "+n+"/"+r);case 19:t.next=33;break;case 21:if(!(c=window.localStorage.getItem("iris.myKey"))){t.next=26;break}Ie=e.fromString(c),t.next=31;break;case 26:return t.next=28,e.generate();case 28:l=t.sent,Ie=Ie||l,window.localStorage.setItem("iris.myKey",e.toString(Ie));case 31:if(Ie){t.next=33;break}throw new Error("loading default key failed - check localStorage iris.myKey");case 33:return t.abrupt("return",Ie);case 34:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),e.getDefault=function(t,n){return void 0===t&&(t="."),void 0===n&&(n="iris.key"),e.getActiveKey(t,n)},e.getActivePub=function(){var t=s(i().mark((function t(n,r){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n="."),void 0===r&&(r="iris.key"),t.next=4,e.getActiveKey(n,r);case 4:return t.abrupt("return",t.sent.pub);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.setActiveKey=function(t,n,r,i,a){if(void 0===n&&(n=!0),void 0===r&&(r="."),void 0===i&&(i="iris.key"),Ie=t,n)if(x.isNode){var s=r+"/"+i;a.writeFileSync(s,e.toString(Ie)),a.chmodSync(s,400)}else window.localStorage.setItem("iris.myKey",e.toString(Ie))},e.toString=function(e){return JSON.stringify(e)},e.getId=function(e){if(!e||!e.pub)throw new Error("missing param");return e.pub},e.fromString=function(e){return JSON.parse(e)},e.generate=function(){return t.SEA.pair()},e.sign=function(){var e=s(i().mark((function e(n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.SEA.sign(n,r);case 2:return e.abrupt("return","a"+e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.verify=function(e,n){return t.SEA.verify(e.slice(1),n)},e}(),qe="Invalid  message:",Re=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(h(Error)),He=function(){function e(e){if(this.signedData=e.signedData,this.pubKey=e.pubKey,e.sig){if("string"!=typeof e.sig)throw new Re("SignedMessage signature must be a string");this.sig=e.sig,this.getHash()}this._validate()}e._getArray=function(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],a=e[n[r]];if("string"==typeof a)t.push(new R(i,a));else for(var s=0;s<a.length;s++)t.push(new R(i,a[s]))}return t},e._getIterable=function(e){var t;return(t={})[Symbol.iterator]=i().mark((function t(){var n,r,a,s,o,u;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Object.keys(e),r=0;case 2:if(!(r<n.length)){t.next=21;break}if(a=n[r],"string"!=typeof(s=e[n[r]])){t.next=10;break}return t.next=8,new R(a,s);case 8:t.next=18;break;case 10:o=0;case 11:if(!(o<s.length)){t.next=18;break}return u=s[o],t.next=15,new R(a,u);case 15:o++,t.next=11;break;case 18:r++,t.next=2;break;case 21:case"end":return t.stop()}}),t)})),t};var t=e.prototype;return t.getAuthorIterable=function(){return e._getIterable(this.signedData.author)},t.getRecipientIterable=function(){return e._getIterable(this.signedData.recipient)},t.getAuthorArray=function(){return e._getArray(this.signedData.author)},t.getRecipientArray=function(){return this.signedData.recipient?e._getArray(this.signedData.recipient):[]},t.getSignerKeyID=function(){return this.pubKey},t._validate=function(){if(!this.signedData)throw new Re(qe+" Missing signedData");if("object"!=typeof this.signedData)throw new Re(qe+" signedData must be an object");var e=this.signedData;if(!e.type)throw new Re(qe+" Missing type definition");if(!e.author)throw new Re(qe+" Missing author");if("object"!=typeof e.author)throw new Re(qe+" Author must be object");if(Array.isArray(e.author))throw new Re(qe+" Author must not be an array");if(0===Object.keys(e.author).length)throw new Re(qe+" Author empty");for(var t in this.pubKey&&(this.signerKeyHash=this.getSignerKeyID()),e.author){var n=typeof e.author[t];if("string"!==n){if(!Array.isArray(e.author[t]))throw new Re(qe+" Author attribute must be string or array, got "+t+": "+e.author[t]);for(var r=0;r<e.author[t].length;r++){if("string"!=typeof e.author[t][r])throw new Re(qe+" Author attribute must be string, got "+t+": ["+e.author[t][r]+"]");if(0===e.author[t][r].length)throw new Re(qe+" author "+t+" in array["+r+"] is empty")}}if("keyID"===t){if("string"!==n)throw new Re(qe+" Author keyID must be string, got "+n);if(this.signerKeyHash&&e.author[t]!==this.signerKeyHash)throw new Re(qe+" If message has a keyID author, it must be signed by the same key")}}if(e.recipient){if("object"!=typeof e.recipient)throw new Re(qe+" Recipient must be object");if(Array.isArray(e.recipient))throw new Re(qe+" Recipient must not be an array");if(0===Object.keys(e.recipient).length)throw new Re(qe+" Recipient empty");for(var i in e.recipient)if("string"!=typeof e.recipient[i]){if(!Array.isArray(e.recipient[i]))throw new Re(qe+" Recipient attribute must be string or array, got "+i+": "+e.recipient[i]);for(var a=0;a<e.recipient[i].length;a++){if("string"!=typeof e.recipient[i][a])throw new Re(qe+" Recipient attribute must be string, got "+i+": ["+e.recipient[i][a]+"]");if(0===e.recipient[i][a].length)throw new Re(qe+" recipient "+i+" in array["+a+"] is empty")}}}if(!e.time&&!e.timestamp)throw new Re(qe+" Missing time field");if(!Date.parse(e.time||e.timestamp))throw new Re(qe+" Invalid time field");if("rating"===e.type){if(isNaN(e.rating))throw new Re(qe+" Invalid rating");if(isNaN(e.maxRating))throw new Re(qe+" Invalid maxRating");if(isNaN(e.minRating))throw new Re(qe+" Invalid minRating");if(e.rating>e.maxRating)throw new Re(qe+" Rating is above maxRating");if(e.rating<e.minRating)throw new Re(qe+" Rating is below minRating");if("string"!=typeof e.context||!e.context.length)throw new Re(qe+" Rating messages must have a context field")}if(("verification"===e.type||"unverification"===e.type)&&e.recipient.length<2)throw new Re(qe+" At least 2 recipient attributes are needed for a connection / disconnection. Got: "+e.recipient);return!0},t.isPositive=function(){return"rating"===this.signedData.type&&this.signedData.rating>(this.signedData.maxRating+this.signedData.minRating)/2},t.isNegative=function(){return"rating"===this.signedData.type&&this.signedData.rating<(this.signedData.maxRating+this.signedData.minRating)/2},t.isNeutral=function(){return"rating"===this.signedData.type&&this.signedData.rating===(this.signedData.maxRating+this.signedData.minRating)/2},t.sign=function(){var e=s(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge.sign(this.signedData,t);case 2:return this.sig=e.sent,this.pubKey=t.pub,e.next=6,this.getHash();case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.create=function(){var t=s(i().mark((function t(n,r){var a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.author&&r&&(n.author={keyID:Ge.getId(r)}),n.time=n.time||(new Date).toISOString(),a=new e({signedData:n}),!r){t.next=6;break}return t.next=6,a.sign(r);case 6:return t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.createVerification=function(t,n){return t.type="verification",e.create(t,n)},e.createRating=function(t,n){return t.type="rating",t.context=t.context||"iris",t.maxRating=t.maxRating||10,t.minRating=t.minRating||-10,e.create(t,n)},t.getAuthor=function(e){for(var t,n=d(this.getAuthorIterable());!(t=n()).done;){var r=t.value;if(r.isUniqueType())return e.getContacts(r)}},t.getRecipient=function(e){if(this.signedData.recipient)for(var t,n=d(this.getRecipientIterable());!(t=n()).done;){var r=t.value;if(r.isUniqueType())return e.getContacts(r)}},t.getHash=function(){var e=s(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sig||this.hash){e.next=4;break}return e.next=3,x.getHash(this.sig);case 3:this.hash=e.sent;case 4:return e.abrupt("return",this.hash);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.getId=function(){return this.getHash()},e.fromSig=function(){var t=s(i().mark((function t(n){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.sig){t.next=2;break}throw new Error("Missing signature in object:",n);case 2:if(n.pubKey){t.next=4;break}throw new Error("Missing pubKey in object:");case 4:return r=JSON.parse(n.sig.slice(4)).m,t.abrupt("return",new e({signedData:r,sig:n.sig,pubKey:n.pubKey}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.verify=function(){var e=s(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pubKey){e.next=2;break}throw new Re(qe+" SignedMessage has no .pubKey");case 2:if(this.sig){e.next=4;break}throw new Re(qe+" SignedMessage has no .sig");case 4:return e.next=6,Ge.verify(this.sig,this.pubKey);case 6:if(this.signedData=e.sent,this.signedData){e.next=9;break}throw new Re(qe+" Invalid signature");case 9:if(!this.hash){e.next=18;break}return e.t0=this.hash,e.next=13,x.getHash(this.sig);case 13:if(e.t1=e.sent,e.t0===e.t1){e.next=16;break}throw new Re(qe+" Invalid message hash");case 16:e.next=19;break;case 18:this.getHash();case 19:return e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.serialize=function(){return{sig:this.sig,pubKey:this.pubKey}},t.toString=function(){return JSON.stringify(this.serialize())},e.deserialize=function(){var t=s(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.fromSig(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.fromString=function(){var t=s(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.fromSig(JSON.parse(n)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.setReaction=function(){var e=s(i().mark((function e(t,n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getHash();case 2:a=e.sent,t.get("reactions").get(a).put(r),t.get("reactions").get(a).put(r),t.get("messagesByHash").get(a).get("reactions").get(this.rootContact.value).put(r),t.get("messagesByHash").get(a).get("reactions").get(this.rootContact.value).put(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),e}();exports.default={local:V,global:G,group:te,public:H,private:Q,static:Ue,electron:Pe,peers:O,session:_e,util:x,notifications:Le,SEA:t.SEA,Gun:t,SignedMessage:He,Channel:J,Node:U};
//# sourceMappingURL=iris.cjs.production.min.js.map
